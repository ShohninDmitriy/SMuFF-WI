window.innerWidth<768&&[].slice.call(document.querySelectorAll("[data-bss-disabled-mobile]")).forEach((function(e){e.classList.remove("animated"),e.removeAttribute("data-bss-hover-animate"),e.removeAttribute("data-aos")})),document.addEventListener("DOMContentLoaded",(function(){[].slice.call(document.querySelectorAll("[data-bss-tooltip]")).map((function(e){return new bootstrap.Tooltip(e)}))}),!1),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Sortable=t()}(this,(function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function n(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),o.forEach((function(t){var o,a,i;o=e,i=n[a=t],a in o?Object.defineProperty(o,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[a]=i}))}return e}function o(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],0<=t.indexOf(n)||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function a(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function i(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var r=i(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),s=i(/Edge/i),l=i(/firefox/i),c=i(/safari/i)&&!i(/chrome/i)&&!i(/android/i),d=i(/iP(ad|od|hone)/i),u=i(/chrome/i)&&i(/android/i),h={capture:!1,passive:!1};function f(e,t,n){e.addEventListener(t,n,!r&&h)}function p(e,t,n){e.removeEventListener(t,n,!r&&h)}function v(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(e){return!1}return!1}}function g(e,t,n,o){if(e){n=n||document;do{if(null!=t&&(">"===t[0]?e.parentNode===n&&v(e,t):v(e,t))||o&&e===n)return e;if(e===n)break}while(e=(a=e).host&&a!==document&&a.host.nodeType?a.host:a.parentNode)}var a;return null}var m,b=/\s+/g;function w(e,t,n){if(e&&t)if(e.classList)e.classList[n?"add":"remove"](t);else{var o=(" "+e.className+" ").replace(b," ").replace(" "+t+" "," ");e.className=(o+(n?" "+t:"")).replace(b," ")}}function $(e,t,n){var o=e&&e.style;if(o){if(void 0===n)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(n=e.currentStyle),void 0===t?n:n[t];t in o||-1!==t.indexOf("webkit")||(t="-webkit-"+t),o[t]=n+("string"==typeof n?"":"px")}}function S(e,t){var n="";if("string"==typeof e)n=e;else do{var o=$(e,"transform");o&&"none"!==o&&(n=o+" "+n)}while(!t&&(e=e.parentNode));var a=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return a&&new a(n)}function C(e,t,n){if(e){var o=e.getElementsByTagName(t),a=0,i=o.length;if(n)for(;a<i;a++)n(o[a],a);return o}return[]}function y(){return document.scrollingElement||document.documentElement}function T(e,t,n,o,a){if(e.getBoundingClientRect||e===window){var i,s,l,c,d,u,h;if(h=e!==window&&e.parentNode&&e!==y()?(s=(i=e.getBoundingClientRect()).top,l=i.left,c=i.bottom,d=i.right,u=i.height,i.width):(l=s=0,c=window.innerHeight,d=window.innerWidth,u=window.innerHeight,window.innerWidth),(t||n)&&e!==window&&(a=a||e.parentNode,!r))do{if(a&&a.getBoundingClientRect&&("none"!==$(a,"transform")||n&&"static"!==$(a,"position"))){var f=a.getBoundingClientRect();s-=f.top+parseInt($(a,"border-top-width")),l-=f.left+parseInt($(a,"border-left-width")),c=s+i.height,d=l+i.width;break}}while(a=a.parentNode);if(o&&e!==window){var p=S(a||e),v=p&&p.a,g=p&&p.d;p&&(c=(s/=g)+(u/=g),d=(l/=v)+(h/=v))}return{top:s,left:l,bottom:c,right:d,width:h,height:u}}}function M(e,t,n){for(var o=x(e,!0),a=T(e)[t];o;){var i=T(o)[n];if(!("top"===n||"left"===n?i<=a:a<=i))return o;if(o===y())break;o=x(o,!1)}return!1}function E(e,t,n){for(var o=0,a=0,i=e.children;a<i.length;){if("none"!==i[a].style.display&&i[a]!==Re.ghost&&i[a]!==Re.dragged&&g(i[a],n.draggable,e,!1)){if(o===t)return i[a];o++}a++}return null}function k(e,t){for(var n=e.lastElementChild;n&&(n===Re.ghost||"none"===$(n,"display")||t&&!v(n,t));)n=n.previousElementSibling;return n||null}function I(e,t){var n=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===Re.clone||t&&!v(e,t)||n++;return n}function D(e){var t=0,n=0,o=y();if(e)do{var a=S(e),i=a.a,r=a.d;t+=e.scrollLeft*i,n+=e.scrollTop*r}while(e!==o&&(e=e.parentNode));return[t,n]}function x(e,t){if(!e||!e.getBoundingClientRect)return y();var n=e,o=!1;do{if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var a=$(n);if(n.clientWidth<n.scrollWidth&&("auto"==a.overflowX||"scroll"==a.overflowX)||n.clientHeight<n.scrollHeight&&("auto"==a.overflowY||"scroll"==a.overflowY)){if(!n.getBoundingClientRect||n===document.body)return y();if(o||t)return n;o=!0}}}while(n=n.parentNode);return y()}function O(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function A(e,t){return function(){if(!m){var n=arguments;1===n.length?e.call(this,n[0]):e.apply(this,n),m=setTimeout((function(){m=void 0}),t)}}}function _(e,t,n){e.scrollLeft+=t,e.scrollTop+=n}function R(e){var t=window.Polymer,n=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):n?n(e).clone(!0)[0]:e.cloneNode(!0)}function P(e,t){$(e,"position","absolute"),$(e,"top",t.top),$(e,"left",t.left),$(e,"width",t.width),$(e,"height",t.height)}function N(e){$(e,"position",""),$(e,"top",""),$(e,"left",""),$(e,"width",""),$(e,"height","")}var F="Sortable"+(new Date).getTime();var W=[],G={initializeByDefault:!0},L={mount:function(e){for(var t in G)!G.hasOwnProperty(t)||t in e||(e[t]=G[t]);W.forEach((function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")})),W.push(e)},pluginEvent:function(e,t,o){var a=this;this.eventCanceled=!1,o.cancel=function(){a.eventCanceled=!0};var i=e+"Global";W.forEach((function(a){t[a.pluginName]&&(t[a.pluginName][i]&&t[a.pluginName][i](n({sortable:t},o)),t.options[a.pluginName]&&t[a.pluginName][e]&&t[a.pluginName][e](n({sortable:t},o)))}))},initializePlugins:function(e,n,o,a){for(var i in W.forEach((function(a){var i=a.pluginName;if(e.options[i]||a.initializeByDefault){var r=new a(e,n,e.options);r.sortable=e,r.options=e.options,e[i]=r,t(o,r.defaults)}})),e.options)if(e.options.hasOwnProperty(i)){var r=this.modifyOption(e,i,e.options[i]);void 0!==r&&(e.options[i]=r)}},getEventProperties:function(e,n){var o={};return W.forEach((function(a){"function"==typeof a.eventProperties&&t(o,a.eventProperties.call(n[a.pluginName],e))})),o},modifyOption:function(e,t,n){var o;return W.forEach((function(a){e[a.pluginName]&&a.optionListeners&&"function"==typeof a.optionListeners[t]&&(o=a.optionListeners[t].call(e[a.pluginName],n))})),o}};function B(e){var t=e.sortable,o=e.rootEl,a=e.name,i=e.targetEl,l=e.cloneEl,c=e.toEl,d=e.fromEl,u=e.oldIndex,h=e.newIndex,f=e.oldDraggableIndex,p=e.newDraggableIndex,v=e.originalEvent,g=e.putSortable,m=e.extraEventProperties;if(t=t||o&&o[F]){var b,w=t.options,$="on"+a.charAt(0).toUpperCase()+a.substr(1);!window.CustomEvent||r||s?(b=document.createEvent("Event")).initEvent(a,!0,!0):b=new CustomEvent(a,{bubbles:!0,cancelable:!0}),b.to=c||o,b.from=d||o,b.item=i||o,b.clone=l,b.oldIndex=u,b.newIndex=h,b.oldDraggableIndex=f,b.newDraggableIndex=p,b.originalEvent=v,b.pullMode=g?g.lastPutMode:void 0;var S=n({},m,L.getEventProperties(a,t));for(var C in S)b[C]=S[C];o&&o.dispatchEvent(b),w[$]&&w[$].call(t,b)}}function X(e,t,a){var i=2<arguments.length&&void 0!==a?a:{},r=i.evt,s=o(i,["evt"]);L.pluginEvent.bind(Re)(e,t,n({dragEl:H,parentEl:V,ghostEl:Y,rootEl:q,nextEl:K,lastDownEl:z,cloneEl:j,cloneHidden:Z,dragStarted:de,putSortable:oe,activeSortable:Re.active,originalEvent:r,oldIndex:J,oldDraggableIndex:ee,newIndex:Q,newDraggableIndex:te,hideGhostForTarget:xe,unhideGhostForTarget:Oe,cloneNowHidden:function(){Z=!0},cloneNowShown:function(){Z=!1},dispatchSortableEvent:function(e){U({sortable:t,name:e,originalEvent:r})}},s))}function U(e){B(n({putSortable:oe,cloneEl:j,targetEl:H,rootEl:q,oldIndex:J,oldDraggableIndex:ee,newIndex:Q,newDraggableIndex:te},e))}var H,V,Y,q,K,z,j,Z,J,Q,ee,te,ne,oe,ae,ie,re,se,le,ce,de,ue,he,fe,pe,ve=!1,ge=!1,me=[],be=!1,we=!1,$e=[],Se=!1,Ce=[],ye="undefined"!=typeof document,Te=d,Me=s||r?"cssFloat":"float",Ee=ye&&!u&&!d&&"draggable"in document.createElement("div"),ke=function(){if(ye){if(r)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),Ie=function(e,t){var n=$(e),o=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),a=E(e,0,t),i=E(e,1,t),r=a&&$(a),s=i&&$(i),l=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+T(a).width,c=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+T(i).width;if("flex"===n.display)return"column"===n.flexDirection||"column-reverse"===n.flexDirection?"vertical":"horizontal";if("grid"===n.display)return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&r.float&&"none"!==r.float){var d="left"===r.float?"left":"right";return!i||"both"!==s.clear&&s.clear!==d?"horizontal":"vertical"}return a&&("block"===r.display||"flex"===r.display||"table"===r.display||"grid"===r.display||o<=l&&"none"===n[Me]||i&&"none"===n[Me]&&o<l+c)?"vertical":"horizontal"},De=function(t){function n(e,t){return function(o,a,i,r){var s=o.options.group.name&&a.options.group.name&&o.options.group.name===a.options.group.name;if(null==e&&(t||s))return!0;if(null==e||!1===e)return!1;if(t&&"clone"===e)return e;if("function"==typeof e)return n(e(o,a,i,r),t)(o,a,i,r);var l=(t?o:a).options.group.name;return!0===e||"string"==typeof e&&e===l||e.join&&-1<e.indexOf(l)}}var o={},a=t.group;a&&"object"==e(a)||(a={name:a}),o.name=a.name,o.checkPull=n(a.pull,!0),o.checkPut=n(a.put),o.revertClone=a.revertClone,t.group=o},xe=function(){!ke&&Y&&$(Y,"display","none")},Oe=function(){!ke&&Y&&$(Y,"display","")};function Ae(e){if(H){var t=function(e,t){var n;return me.some((function(o){if(!k(o)){var a=T(o),i=o[F].options.emptyInsertThreshold,r=e>=a.left-i&&e<=a.right+i,s=t>=a.top-i&&t<=a.bottom+i;return i&&r&&s?n=o:void 0}})),n}((e=e.touches?e.touches[0]:e).clientX,e.clientY);if(t){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);n.target=n.rootEl=t,n.preventDefault=void 0,n.stopPropagation=void 0,t[F]._onDragOver(n)}}}function _e(e){H&&H.parentNode[F]._isOutsideThisEl(e.target)}function Re(e,o){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=o=t({},o),e[F]=this;var a={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Ie(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Re.supportPointer&&"PointerEvent"in window&&!c,emptyInsertThreshold:5};for(var i in L.initializePlugins(this,e,a),a)i in o||(o[i]=a[i]);for(var r in De(o),this)"_"===r.charAt(0)&&"function"==typeof this[r]&&(this[r]=this[r].bind(this));this.nativeDraggable=!o.forceFallback&&Ee,this.nativeDraggable&&(this.options.touchStartThreshold=1),o.supportPointer?f(e,"pointerdown",this._onTapStart):(f(e,"mousedown",this._onTapStart),f(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(f(e,"dragover",this),f(e,"dragenter",this)),me.push(this.el),o.store&&o.store.get&&this.sort(o.store.get(this)||[]),t(this,function(){var e,t=[];return{captureAnimationState:function(){t=[],this.options.animation&&[].slice.call(this.el.children).forEach((function(e){if("none"!==$(e,"display")&&e!==Re.ghost){t.push({target:e,rect:T(e)});var o=n({},t[t.length-1].rect);if(e.thisAnimationDuration){var a=S(e,!0);a&&(o.top-=a.f,o.left-=a.e)}e.fromRect=o}}))},addAnimationState:function(e){t.push(e)},removeAnimationState:function(e){t.splice(function(e,t){for(var n in e)if(e.hasOwnProperty(n))for(var o in t)if(t.hasOwnProperty(o)&&t[o]===e[n][o])return Number(n);return-1}(t,{target:e}),1)},animateAll:function(n){var o=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof n&&n());var a=!1,i=0;t.forEach((function(e){var t=0,n=e.target,r=n.fromRect,s=T(n),l=n.prevFromRect,c=n.prevToRect,d=e.rect,u=S(n,!0);u&&(s.top-=u.f,s.left-=u.e),n.toRect=s,n.thisAnimationDuration&&O(l,s)&&!O(r,s)&&(d.top-s.top)/(d.left-s.left)==(r.top-s.top)/(r.left-s.left)&&(t=function(e,t,n,o){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-n.top,2)+Math.pow(t.left-n.left,2))*o.animation}(d,l,c,o.options)),O(s,r)||(n.prevFromRect=r,n.prevToRect=s,t||(t=o.options.animation),o.animate(n,d,s,t)),t&&(a=!0,i=Math.max(i,t),clearTimeout(n.animationResetTimer),n.animationResetTimer=setTimeout((function(){n.animationTime=0,n.prevFromRect=null,n.fromRect=null,n.prevToRect=null,n.thisAnimationDuration=null}),t),n.thisAnimationDuration=t)})),clearTimeout(e),a?e=setTimeout((function(){"function"==typeof n&&n()}),i):"function"==typeof n&&n(),t=[]},animate:function(e,t,n,o){if(o){$(e,"transition",""),$(e,"transform","");var a=S(this.el),i=a&&a.a,r=a&&a.d,s=(t.left-n.left)/(i||1),l=(t.top-n.top)/(r||1);e.animatingX=!!s,e.animatingY=!!l,$(e,"transform","translate3d("+s+"px,"+l+"px,0)"),this.forRepaintDummy=function(e){return e.offsetWidth}(e),$(e,"transition","transform "+o+"ms"+(this.options.easing?" "+this.options.easing:"")),$(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout((function(){$(e,"transition",""),$(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1}),o)}}}}())}function Pe(e,t,n,o,a,i,l,c){var d,u,h=e[F],f=h.options.onMove;return!window.CustomEvent||r||s?(d=document.createEvent("Event")).initEvent("move",!0,!0):d=new CustomEvent("move",{bubbles:!0,cancelable:!0}),d.to=t,d.from=e,d.dragged=n,d.draggedRect=o,d.related=a||t,d.relatedRect=i||T(t),d.willInsertAfter=c,d.originalEvent=l,e.dispatchEvent(d),f&&(u=f.call(h,d,l)),u}function Ne(e){e.draggable=!1}function Fe(){Se=!1}function We(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,n=t.length,o=0;n--;)o+=t.charCodeAt(n);return o.toString(36)}function Ge(e){return setTimeout(e,0)}function Le(e){return clearTimeout(e)}ye&&document.addEventListener("click",(function(e){if(ge)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),ge=!1}),!0),Re.prototype={constructor:Re,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(ue=null)},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,H):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,n=this.el,o=this.options,a=o.preventOnFilter,i=e.type,r=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,s=(r||e).target,l=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||s,d=o.filter;if(function(e){Ce.length=0;for(var t=e.getElementsByTagName("input"),n=t.length;n--;){var o=t[n];o.checked&&Ce.push(o)}}(n),!H&&!(/mousedown|pointerdown/.test(i)&&0!==e.button||o.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!c||!s||"SELECT"!==s.tagName.toUpperCase())&&!((s=g(s,o.draggable,n,!1))&&s.animated||z===s)){if(J=I(s),ee=I(s,o.draggable),"function"==typeof d){if(d.call(this,e,s,this))return U({sortable:t,rootEl:l,name:"filter",targetEl:s,toEl:n,fromEl:n}),X("filter",t,{evt:e}),void(a&&e.cancelable&&e.preventDefault())}else if(d&&(d=d.split(",").some((function(o){if(o=g(l,o.trim(),n,!1))return U({sortable:t,rootEl:o,name:"filter",targetEl:s,fromEl:n,toEl:n}),X("filter",t,{evt:e}),!0}))))return void(a&&e.cancelable&&e.preventDefault());o.handle&&!g(l,o.handle,n,!1)||this._prepareDragStart(e,r,s)}}},_prepareDragStart:function(e,t,n){var o,a=this,i=a.el,c=a.options,d=i.ownerDocument;if(n&&!H&&n.parentNode===i){var u=T(n);if(q=i,V=(H=n).parentNode,K=H.nextSibling,z=n,ne=c.group,ae={target:Re.dragged=H,clientX:(t||e).clientX,clientY:(t||e).clientY},le=ae.clientX-u.left,ce=ae.clientY-u.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,H.style["will-change"]="all",o=function(){X("delayEnded",a,{evt:e}),Re.eventCanceled?a._onDrop():(a._disableDelayedDragEvents(),!l&&a.nativeDraggable&&(H.draggable=!0),a._triggerDragStart(e,t),U({sortable:a,name:"choose",originalEvent:e}),w(H,c.chosenClass,!0))},c.ignore.split(",").forEach((function(e){C(H,e.trim(),Ne)})),f(d,"dragover",Ae),f(d,"mousemove",Ae),f(d,"touchmove",Ae),f(d,"mouseup",a._onDrop),f(d,"touchend",a._onDrop),f(d,"touchcancel",a._onDrop),l&&this.nativeDraggable&&(this.options.touchStartThreshold=4,H.draggable=!0),X("delayStart",this,{evt:e}),!c.delay||c.delayOnTouchOnly&&!t||this.nativeDraggable&&(s||r))o();else{if(Re.eventCanceled)return void this._onDrop();f(d,"mouseup",a._disableDelayedDrag),f(d,"touchend",a._disableDelayedDrag),f(d,"touchcancel",a._disableDelayedDrag),f(d,"mousemove",a._delayedDragTouchMoveHandler),f(d,"touchmove",a._delayedDragTouchMoveHandler),c.supportPointer&&f(d,"pointermove",a._delayedDragTouchMoveHandler),a._dragStartTimer=setTimeout(o,c.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){H&&Ne(H),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;p(e,"mouseup",this._disableDelayedDrag),p(e,"touchend",this._disableDelayedDrag),p(e,"touchcancel",this._disableDelayedDrag),p(e,"mousemove",this._delayedDragTouchMoveHandler),p(e,"touchmove",this._delayedDragTouchMoveHandler),p(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?f(document,"pointermove",this._onTouchMove):f(document,t?"touchmove":"mousemove",this._onTouchMove):(f(H,"dragend",this),f(q,"dragstart",this._onDragStart));try{document.selection?Ge((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(e,t){if(ve=!1,q&&H){X("dragStarted",this,{evt:t}),this.nativeDraggable&&f(document,"dragover",_e);var n=this.options;e||w(H,n.dragClass,!1),w(H,n.ghostClass,!0),Re.active=this,e&&this._appendGhost(),U({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(ie){this._lastX=ie.clientX,this._lastY=ie.clientY,xe();for(var e=document.elementFromPoint(ie.clientX,ie.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(ie.clientX,ie.clientY))!==t;)t=e;if(H.parentNode[F]._isOutsideThisEl(e),t)do{if(t[F]&&t[F]._onDragOver({clientX:ie.clientX,clientY:ie.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break;e=t}while(t=t.parentNode);Oe()}},_onTouchMove:function(e){if(ae){var t=this.options,n=t.fallbackTolerance,o=t.fallbackOffset,a=e.touches?e.touches[0]:e,i=Y&&S(Y,!0),r=Y&&i&&i.a,s=Y&&i&&i.d,l=Te&&pe&&D(pe),c=(a.clientX-ae.clientX+o.x)/(r||1)+(l?l[0]-$e[0]:0)/(r||1),d=(a.clientY-ae.clientY+o.y)/(s||1)+(l?l[1]-$e[1]:0)/(s||1);if(!Re.active&&!ve){if(n&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(Y){i?(i.e+=c-(re||0),i.f+=d-(se||0)):i={a:1,b:0,c:0,d:1,e:c,f:d};var u="matrix(".concat(i.a,",").concat(i.b,",").concat(i.c,",").concat(i.d,",").concat(i.e,",").concat(i.f,")");$(Y,"webkitTransform",u),$(Y,"mozTransform",u),$(Y,"msTransform",u),$(Y,"transform",u),re=c,se=d,ie=a}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!Y){var e=this.options.fallbackOnBody?document.body:q,t=T(H,!0,Te,!0,e),n=this.options;if(Te){for(pe=e;"static"===$(pe,"position")&&"none"===$(pe,"transform")&&pe!==document;)pe=pe.parentNode;pe!==document.body&&pe!==document.documentElement?(pe===document&&(pe=y()),t.top+=pe.scrollTop,t.left+=pe.scrollLeft):pe=y(),$e=D(pe)}w(Y=H.cloneNode(!0),n.ghostClass,!1),w(Y,n.fallbackClass,!0),w(Y,n.dragClass,!0),$(Y,"transition",""),$(Y,"transform",""),$(Y,"box-sizing","border-box"),$(Y,"margin",0),$(Y,"top",t.top),$(Y,"left",t.left),$(Y,"width",t.width),$(Y,"height",t.height),$(Y,"opacity","0.8"),$(Y,"position",Te?"absolute":"fixed"),$(Y,"zIndex","100000"),$(Y,"pointerEvents","none"),Re.ghost=Y,e.appendChild(Y),$(Y,"transform-origin",le/parseInt(Y.style.width)*100+"% "+ce/parseInt(Y.style.height)*100+"%")}},_onDragStart:function(e,t){var n=this,o=e.dataTransfer,a=n.options;X("dragStart",this,{evt:e}),Re.eventCanceled?this._onDrop():(X("setupClone",this),Re.eventCanceled||((j=R(H)).draggable=!1,j.style["will-change"]="",this._hideClone(),w(j,this.options.chosenClass,!1),Re.clone=j),n.cloneId=Ge((function(){X("clone",n),Re.eventCanceled||(n.options.removeCloneOnHide||q.insertBefore(j,H),n._hideClone(),U({sortable:n,name:"clone"}))})),t||w(H,a.dragClass,!0),t?(ge=!0,n._loopId=setInterval(n._emulateDragOver,50)):(p(document,"mouseup",n._onDrop),p(document,"touchend",n._onDrop),p(document,"touchcancel",n._onDrop),o&&(o.effectAllowed="move",a.setData&&a.setData.call(n,o,H)),f(document,"drop",n),$(H,"transform","translateZ(0)")),ve=!0,n._dragStartId=Ge(n._dragStarted.bind(n,t,e)),f(document,"selectstart",n),de=!0,c&&$(document.body,"user-select","none"))},_onDragOver:function(e){var t,o,a,i,r=this.el,s=e.target,l=this.options,c=l.group,d=Re.active,u=ne===c,h=l.sort,f=oe||d,p=this,v=!1;if(!Se){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),s=g(s,l.draggable,r,!0),W("dragOver"),Re.eventCanceled)return v;if(H.contains(e.target)||s.animated&&s.animatingX&&s.animatingY||p._ignoreWhileAnimating===s)return L(!1);if(ge=!1,d&&!l.disabled&&(u?h||(a=!q.contains(H)):oe===this||(this.lastPutMode=ne.checkPull(this,d,H,e))&&c.checkPut(this,d,H,e))){if(i="vertical"===this._getDirection(e,s),t=T(H),W("dragOverValid"),Re.eventCanceled)return v;if(a)return V=q,G(),this._hideClone(),W("revert"),Re.eventCanceled||(K?q.insertBefore(H,K):q.appendChild(H)),L(!0);var m=k(r,l.draggable);if(!m||function(e,t,n){var o=T(k(n.el,n.options.draggable));return t?e.clientX>o.right+10||e.clientX<=o.right&&e.clientY>o.bottom&&e.clientX>=o.left:e.clientX>o.right&&e.clientY>o.top||e.clientX<=o.right&&e.clientY>o.bottom+10}(e,i,this)&&!m.animated){if(m===H)return L(!1);if(m&&r===e.target&&(s=m),s&&(o=T(s)),!1!==Pe(q,r,H,t,s,o,e,!!s))return G(),r.appendChild(H),V=r,B(),L(!0)}else if(s.parentNode===r){o=T(s);var b,S,C,y=H.parentNode!==r,E=!function(e,t,n){var o=n?e.left:e.top,a=n?e.right:e.bottom,i=n?e.width:e.height,r=n?t.left:t.top,s=n?t.right:t.bottom,l=n?t.width:t.height;return o===r||a===s||o+i/2===r+l/2}(H.animated&&H.toRect||t,s.animated&&s.toRect||o,i),D=i?"top":"left",x=M(s,"top","top")||M(H,"top","top"),O=x?x.scrollTop:void 0;if(ue!==s&&(S=o[D],be=!1,we=!E&&l.invertSwap||y),0!==(b=function(e,t,n,o,a,i,r,s){var l=o?e.clientY:e.clientX,c=o?n.height:n.width,d=o?n.top:n.left,u=o?n.bottom:n.right,h=!1;if(!r)if(s&&fe<c*a){if(!be&&(1===he?d+c*i/2<l:l<u-c*i/2)&&(be=!0),be)h=!0;else if(1===he?l<d+fe:u-fe<l)return-he}else if(d+c*(1-a)/2<l&&l<u-c*(1-a)/2)return function(e){return I(H)<I(e)?1:-1}(t);return(h=h||r)&&(l<d+c*i/2||u-c*i/2<l)?d+c/2<l?1:-1:0}(e,s,o,i,E?1:l.swapThreshold,null==l.invertedSwapThreshold?l.swapThreshold:l.invertedSwapThreshold,we,ue===s)))for(var A=I(H);A-=b,(C=V.children[A])&&("none"===$(C,"display")||C===Y););if(0===b||C===s)return L(!1);he=b;var R=(ue=s).nextElementSibling,P=!1,N=Pe(q,r,H,t,s,o,e,P=1===b);if(!1!==N)return 1!==N&&-1!==N||(P=1===N),Se=!0,setTimeout(Fe,30),G(),P&&!R?r.appendChild(H):s.parentNode.insertBefore(H,P?R:s),x&&_(x,0,O-x.scrollTop),V=H.parentNode,void 0===S||we||(fe=Math.abs(S-T(s)[D])),B(),L(!0)}if(r.contains(H))return L(!1)}return!1}function W(l,c){X(l,p,n({evt:e,isOwner:u,axis:i?"vertical":"horizontal",revert:a,dragRect:t,targetRect:o,canSort:h,fromSortable:f,target:s,completed:L,onMove:function(n,o){return Pe(q,r,H,t,n,T(n),e,o)},changed:B},c))}function G(){W("dragOverAnimationCapture"),p.captureAnimationState(),p!==f&&f.captureAnimationState()}function L(t){return W("dragOverCompleted",{insertion:t}),t&&(u?d._hideClone():d._showClone(p),p!==f&&(w(H,oe?oe.options.ghostClass:d.options.ghostClass,!1),w(H,l.ghostClass,!0)),oe!==p&&p!==Re.active?oe=p:p===Re.active&&oe&&(oe=null),f===p&&(p._ignoreWhileAnimating=s),p.animateAll((function(){W("dragOverAnimationComplete"),p._ignoreWhileAnimating=null})),p!==f&&(f.animateAll(),f._ignoreWhileAnimating=null)),(s===H&&!H.animated||s===r&&!s.animated)&&(ue=null),l.dragoverBubble||e.rootEl||s===document||(H.parentNode[F]._isOutsideThisEl(e.target),t||Ae(e)),!l.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),v=!0}function B(){Q=I(H),te=I(H,l.draggable),U({sortable:p,name:"change",toEl:r,newIndex:Q,newDraggableIndex:te,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){p(document,"mousemove",this._onTouchMove),p(document,"touchmove",this._onTouchMove),p(document,"pointermove",this._onTouchMove),p(document,"dragover",Ae),p(document,"mousemove",Ae),p(document,"touchmove",Ae)},_offUpEvents:function(){var e=this.el.ownerDocument;p(e,"mouseup",this._onDrop),p(e,"touchend",this._onDrop),p(e,"pointerup",this._onDrop),p(e,"touchcancel",this._onDrop),p(document,"selectstart",this)},_onDrop:function(e){var t=this.el,n=this.options;Q=I(H),te=I(H,n.draggable),X("drop",this,{evt:e}),V=H&&H.parentNode,Q=I(H),te=I(H,n.draggable),Re.eventCanceled||(be=we=ve=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Le(this.cloneId),Le(this._dragStartId),this.nativeDraggable&&(p(document,"drop",this),p(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),c&&$(document.body,"user-select",""),$(H,"transform",""),e&&(de&&(e.cancelable&&e.preventDefault(),n.dropBubble||e.stopPropagation()),Y&&Y.parentNode&&Y.parentNode.removeChild(Y),(q===V||oe&&"clone"!==oe.lastPutMode)&&j&&j.parentNode&&j.parentNode.removeChild(j),H&&(this.nativeDraggable&&p(H,"dragend",this),Ne(H),H.style["will-change"]="",de&&!ve&&w(H,oe?oe.options.ghostClass:this.options.ghostClass,!1),w(H,this.options.chosenClass,!1),U({sortable:this,name:"unchoose",toEl:V,newIndex:null,newDraggableIndex:null,originalEvent:e}),q!==V?(0<=Q&&(U({rootEl:V,name:"add",toEl:V,fromEl:q,originalEvent:e}),U({sortable:this,name:"remove",toEl:V,originalEvent:e}),U({rootEl:V,name:"sort",toEl:V,fromEl:q,originalEvent:e}),U({sortable:this,name:"sort",toEl:V,originalEvent:e})),oe&&oe.save()):Q!==J&&0<=Q&&(U({sortable:this,name:"update",toEl:V,originalEvent:e}),U({sortable:this,name:"sort",toEl:V,originalEvent:e})),Re.active&&(null!=Q&&-1!==Q||(Q=J,te=ee),U({sortable:this,name:"end",toEl:V,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){X("nulling",this),q=H=V=Y=K=j=z=Z=ae=ie=de=Q=te=J=ee=ue=he=oe=ne=Re.dragged=Re.ghost=Re.clone=Re.active=null,Ce.forEach((function(e){e.checked=!0})),Ce.length=re=se=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":H&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],n=this.el.children,o=0,a=n.length,i=this.options;o<a;o++)g(e=n[o],i.draggable,this.el,!1)&&t.push(e.getAttribute(i.dataIdAttr)||We(e));return t},sort:function(e,t){var n={},o=this.el;this.toArray().forEach((function(e,t){var a=o.children[t];g(a,this.options.draggable,o,!1)&&(n[e]=a)}),this),t&&this.captureAnimationState(),e.forEach((function(e){n[e]&&(o.removeChild(n[e]),o.appendChild(n[e]))})),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return g(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(void 0===t)return n[e];var o=L.modifyOption(this,e,t);n[e]=void 0!==o?o:t,"group"===e&&De(n)},destroy:function(){X("destroy",this);var e=this.el;e[F]=null,p(e,"mousedown",this._onTapStart),p(e,"touchstart",this._onTapStart),p(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(p(e,"dragover",this),p(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),(function(e){e.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),me.splice(me.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Z){if(X("hideClone",this),Re.eventCanceled)return;$(j,"display","none"),this.options.removeCloneOnHide&&j.parentNode&&j.parentNode.removeChild(j),Z=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(Z){if(X("showClone",this),Re.eventCanceled)return;H.parentNode!=q||this.options.group.revertClone?K?q.insertBefore(j,K):q.appendChild(j):q.insertBefore(j,H),this.options.group.revertClone&&this.animate(H,j),$(j,"display",""),Z=!1}}else this._hideClone()}},ye&&f(document,"touchmove",(function(e){(Re.active||ve)&&e.cancelable&&e.preventDefault()})),Re.utils={on:f,off:p,css:$,find:C,is:function(e,t){return!!g(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},throttle:A,closest:g,toggleClass:w,clone:R,index:I,nextTick:Ge,cancelNextTick:Le,detectDirection:Ie,getChild:E},Re.get=function(e){return e[F]},Re.mount=function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];t[0].constructor===Array&&(t=t[0]),t.forEach((function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(Re.utils=n({},Re.utils,e.utils)),L.mount(e)}))},Re.create=function(e,t){return new Re(e,t)};var Be,Xe,Ue,He,Ve,Ye,qe=[],Ke=!(Re.version="1.13.0");function ze(){qe.forEach((function(e){clearInterval(e.pid)})),qe=[]}function je(){clearInterval(Ye)}function Ze(e){var t=e.originalEvent,n=e.putSortable,o=e.dragEl,a=e.activeSortable,i=e.dispatchSortableEvent,r=e.hideGhostForTarget,s=e.unhideGhostForTarget;if(t){var l=n||a;r();var c=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,d=document.elementFromPoint(c.clientX,c.clientY);s(),l&&!l.el.contains(d)&&(i("spill"),this.onSpill({dragEl:o,putSortable:n}))}}var Je,Qe=A((function(e,t,n,o){if(t.scroll){var a,i=(e.touches?e.touches[0]:e).clientX,r=(e.touches?e.touches[0]:e).clientY,s=t.scrollSensitivity,l=t.scrollSpeed,c=y(),d=!1;Xe!==n&&(Xe=n,ze(),Be=t.scroll,a=t.scrollFn,!0===Be&&(Be=x(n,!0)));var u=0,h=Be;do{var f,p=h,v=T(p),g=v.top,m=v.bottom,b=v.left,w=v.right,S=v.width,C=v.height,M=void 0,E=p.scrollWidth,k=p.scrollHeight,I=$(p),D=p.scrollLeft,O=p.scrollTop;f=p===c?(M=S<E&&("auto"===I.overflowX||"scroll"===I.overflowX||"visible"===I.overflowX),C<k&&("auto"===I.overflowY||"scroll"===I.overflowY||"visible"===I.overflowY)):(M=S<E&&("auto"===I.overflowX||"scroll"===I.overflowX),C<k&&("auto"===I.overflowY||"scroll"===I.overflowY));var A=M&&(Math.abs(w-i)<=s&&D+S<E)-(Math.abs(b-i)<=s&&!!D),R=f&&(Math.abs(m-r)<=s&&O+C<k)-(Math.abs(g-r)<=s&&!!O);if(!qe[u])for(var P=0;P<=u;P++)qe[P]||(qe[P]={});qe[u].vx==A&&qe[u].vy==R&&qe[u].el===p||(qe[u].el=p,qe[u].vx=A,qe[u].vy=R,clearInterval(qe[u].pid),0==A&&0==R||(d=!0,qe[u].pid=setInterval(function(){o&&0===this.layer&&Re.active._onTouchMove(Ve);var t=qe[this.layer].vy?qe[this.layer].vy*l:0,n=qe[this.layer].vx?qe[this.layer].vx*l:0;"function"==typeof a&&"continue"!==a.call(Re.dragged.parentNode[F],n,t,e,Ve,qe[this.layer].el)||_(qe[this.layer].el,n,t)}.bind({layer:u}),24))),u++}while(t.bubbleScroll&&h!==c&&(h=x(h,!1)));Ke=d}}),30);function et(){}function tt(){}et.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var o=E(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(t,o):this.sortable.el.appendChild(t),this.sortable.animateAll(),n&&n.animateAll()},drop:Ze},t(et,{pluginName:"revertOnSpill"}),tt.prototype={onSpill:function(e){var t=e.dragEl,n=e.putSortable||this.sortable;n.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),n.animateAll()},drop:Ze},t(tt,{pluginName:"removeOnSpill"});var nt,ot,at,it,rt,st=[],lt=[],ct=!1,dt=!1,ut=!1;function ht(e,t){lt.forEach((function(n,o){var a=t.children[n.sortableIndex+(e?Number(o):0)];a?t.insertBefore(n,a):t.appendChild(n)}))}function ft(){st.forEach((function(e){e!==at&&e.parentNode&&e.parentNode.removeChild(e)}))}return Re.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?f(document,"dragover",this._handleAutoScroll):this.options.supportPointer?f(document,"pointermove",this._handleFallbackAutoScroll):t.touches?f(document,"touchmove",this._handleFallbackAutoScroll):f(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?p(document,"dragover",this._handleAutoScroll):(p(document,"pointermove",this._handleFallbackAutoScroll),p(document,"touchmove",this._handleFallbackAutoScroll),p(document,"mousemove",this._handleFallbackAutoScroll)),je(),ze(),clearTimeout(m),m=void 0},nulling:function(){Ve=Xe=Be=Ke=Ye=Ue=He=null,qe.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var n=this,o=(e.touches?e.touches[0]:e).clientX,a=(e.touches?e.touches[0]:e).clientY,i=document.elementFromPoint(o,a);if(Ve=e,t||s||r||c){Qe(e,this.options,i,t);var l=x(i,!0);!Ke||Ye&&o===Ue&&a===He||(Ye&&je(),Ye=setInterval((function(){var i=x(document.elementFromPoint(o,a),!0);i!==l&&(l=i,ze()),Qe(e,n.options,i,t)}),10),Ue=o,He=a)}else{if(!this.options.bubbleScroll||x(i,!0)===y())return void ze();Qe(e,this.options,x(i,!1),!1)}}},t(e,{pluginName:"scroll",initializeByDefault:!0})}),Re.mount(tt,et),Re.mount(new function(){function e(){this.defaults={swapClass:"sortable-swap-highlight"}}return e.prototype={dragStart:function(e){var t=e.dragEl;Je=t},dragOverValid:function(e){var t=e.completed,n=e.target,o=e.onMove,a=e.activeSortable,i=e.changed,r=e.cancel;if(a.options.swap){var s=this.sortable.el,l=this.options;if(n&&n!==s){var c=Je;Je=!1!==o(n)?(w(n,l.swapClass,!0),n):null,c&&c!==Je&&w(c,l.swapClass,!1)}i(),t(!0),r()}},drop:function(e){var t=e.activeSortable,n=e.putSortable,o=e.dragEl,a=n||this.sortable,i=this.options;Je&&w(Je,i.swapClass,!1),Je&&(i.swap||n&&n.options.swap)&&o!==Je&&(a.captureAnimationState(),a!==t&&t.captureAnimationState(),function(e,t){var n,o,a=e.parentNode,i=t.parentNode;a&&i&&!a.isEqualNode(t)&&!i.isEqualNode(e)&&(n=I(e),o=I(t),a.isEqualNode(i)&&n<o&&o++,a.insertBefore(t,a.children[n]),i.insertBefore(e,i.children[o]))}(o,Je),a.animateAll(),a!==t&&t.animateAll())},nulling:function(){Je=null}},t(e,{pluginName:"swap",eventProperties:function(){return{swapItem:Je}}})}),Re.mount(new function(){function e(e){for(var t in this)"_"===t.charAt(0)&&"function"==typeof this[t]&&(this[t]=this[t].bind(this));e.options.supportPointer?f(document,"pointerup",this._deselectMultiDrag):(f(document,"mouseup",this._deselectMultiDrag),f(document,"touchend",this._deselectMultiDrag)),f(document,"keydown",this._checkKeyDown),f(document,"keyup",this._checkKeyUp),this.defaults={selectedClass:"sortable-selected",multiDragKey:null,setData:function(t,n){var o="";st.length&&ot===e?st.forEach((function(e,t){o+=(t?", ":"")+e.textContent})):o=n.textContent,t.setData("Text",o)}}}return e.prototype={multiDragKeyDown:!1,isMultiDrag:!1,delayStartGlobal:function(e){var t=e.dragEl;at=t},delayEnded:function(){this.isMultiDrag=~st.indexOf(at)},setupClone:function(e){var t=e.sortable,n=e.cancel;if(this.isMultiDrag){for(var o=0;o<st.length;o++)lt.push(R(st[o])),lt[o].sortableIndex=st[o].sortableIndex,lt[o].draggable=!1,lt[o].style["will-change"]="",w(lt[o],this.options.selectedClass,!1),st[o]===at&&w(lt[o],this.options.chosenClass,!1);t._hideClone(),n()}},clone:function(e){var t=e.sortable,n=e.rootEl,o=e.dispatchSortableEvent,a=e.cancel;this.isMultiDrag&&(this.options.removeCloneOnHide||st.length&&ot===t&&(ht(!0,n),o("clone"),a()))},showClone:function(e){var t=e.cloneNowShown,n=e.rootEl,o=e.cancel;this.isMultiDrag&&(ht(!1,n),lt.forEach((function(e){$(e,"display","")})),t(),rt=!1,o())},hideClone:function(e){var t=this,n=(e.sortable,e.cloneNowHidden),o=e.cancel;this.isMultiDrag&&(lt.forEach((function(e){$(e,"display","none"),t.options.removeCloneOnHide&&e.parentNode&&e.parentNode.removeChild(e)})),n(),rt=!0,o())},dragStartGlobal:function(e){e.sortable,!this.isMultiDrag&&ot&&ot.multiDrag._deselectMultiDrag(),st.forEach((function(e){e.sortableIndex=I(e)})),st=st.sort((function(e,t){return e.sortableIndex-t.sortableIndex})),ut=!0},dragStarted:function(e){var t=this,n=e.sortable;if(this.isMultiDrag){if(this.options.sort&&(n.captureAnimationState(),this.options.animation)){st.forEach((function(e){e!==at&&$(e,"position","absolute")}));var o=T(at,!1,!0,!0);st.forEach((function(e){e!==at&&P(e,o)})),ct=dt=!0}n.animateAll((function(){ct=dt=!1,t.options.animation&&st.forEach((function(e){N(e)})),t.options.sort&&ft()}))}},dragOver:function(e){var t=e.target,n=e.completed,o=e.cancel;dt&&~st.indexOf(t)&&(n(!1),o())},revert:function(e){var t=e.fromSortable,n=e.rootEl,o=e.sortable,a=e.dragRect;1<st.length&&(st.forEach((function(e){o.addAnimationState({target:e,rect:dt?T(e):a}),N(e),e.fromRect=a,t.removeAnimationState(e)})),dt=!1,function(e,t){st.forEach((function(n,o){var a=t.children[n.sortableIndex+(e?Number(o):0)];a?t.insertBefore(n,a):t.appendChild(n)}))}(!this.options.removeCloneOnHide,n))},dragOverCompleted:function(e){var t=e.sortable,n=e.isOwner,o=e.insertion,a=e.activeSortable,i=e.parentEl,r=e.putSortable,s=this.options;if(o){if(n&&a._hideClone(),ct=!1,s.animation&&1<st.length&&(dt||!n&&!a.options.sort&&!r)){var l=T(at,!1,!0,!0);st.forEach((function(e){e!==at&&(P(e,l),i.appendChild(e))})),dt=!0}if(!n)if(dt||ft(),1<st.length){var c=rt;a._showClone(t),a.options.animation&&!rt&&c&&lt.forEach((function(e){a.addAnimationState({target:e,rect:it}),e.fromRect=it,e.thisAnimationDuration=null}))}else a._showClone(t)}},dragOverAnimationCapture:function(e){var n=e.dragRect,o=e.isOwner,a=e.activeSortable;if(st.forEach((function(e){e.thisAnimationDuration=null})),a.options.animation&&!o&&a.multiDrag.isMultiDrag){it=t({},n);var i=S(at,!0);it.top-=i.f,it.left-=i.e}},dragOverAnimationComplete:function(){dt&&(dt=!1,ft())},drop:function(e){var t=e.originalEvent,n=e.rootEl,o=e.parentEl,a=e.sortable,i=e.dispatchSortableEvent,r=e.oldIndex,s=e.putSortable,l=s||this.sortable;if(t){var c=this.options,d=o.children;if(!ut)if(c.multiDragKey&&!this.multiDragKeyDown&&this._deselectMultiDrag(),w(at,c.selectedClass,!~st.indexOf(at)),~st.indexOf(at))st.splice(st.indexOf(at),1),nt=null,B({sortable:a,rootEl:n,name:"deselect",targetEl:at,originalEvt:t});else{if(st.push(at),B({sortable:a,rootEl:n,name:"select",targetEl:at,originalEvt:t}),t.shiftKey&&nt&&a.el.contains(nt)){var u,h,f=I(nt),p=I(at);if(~f&&~p&&f!==p)for(u=f<p?(h=f,p):(h=p,f+1);h<u;h++)~st.indexOf(d[h])||(w(d[h],c.selectedClass,!0),st.push(d[h]),B({sortable:a,rootEl:n,name:"select",targetEl:d[h],originalEvt:t}))}else nt=at;ot=l}if(ut&&this.isMultiDrag){if((o[F].options.sort||o!==n)&&1<st.length){var v=T(at),g=I(at,":not(."+this.options.selectedClass+")");if(!ct&&c.animation&&(at.thisAnimationDuration=null),l.captureAnimationState(),!ct&&(c.animation&&(at.fromRect=v,st.forEach((function(e){if(e.thisAnimationDuration=null,e!==at){var t=dt?T(e):v;e.fromRect=t,l.addAnimationState({target:e,rect:t})}}))),ft(),st.forEach((function(e){d[g]?o.insertBefore(e,d[g]):o.appendChild(e),g++})),r===I(at))){var m=!1;st.forEach((function(e){e.sortableIndex===I(e)||(m=!0)})),m&&i("update")}st.forEach((function(e){N(e)})),l.animateAll()}ot=l}(n===o||s&&"clone"!==s.lastPutMode)&&lt.forEach((function(e){e.parentNode&&e.parentNode.removeChild(e)}))}},nullingGlobal:function(){this.isMultiDrag=ut=!1,lt.length=0},destroyGlobal:function(){this._deselectMultiDrag(),p(document,"pointerup",this._deselectMultiDrag),p(document,"mouseup",this._deselectMultiDrag),p(document,"touchend",this._deselectMultiDrag),p(document,"keydown",this._checkKeyDown),p(document,"keyup",this._checkKeyUp)},_deselectMultiDrag:function(e){if(!(void 0!==ut&&ut||ot!==this.sortable||e&&g(e.target,this.options.draggable,this.sortable.el,!1)||e&&0!==e.button))for(;st.length;){var t=st[0];w(t,this.options.selectedClass,!1),st.shift(),B({sortable:this.sortable,rootEl:this.sortable.el,name:"deselect",targetEl:t,originalEvt:e})}},_checkKeyDown:function(e){e.key===this.options.multiDragKey&&(this.multiDragKeyDown=!0)},_checkKeyUp:function(e){e.key===this.options.multiDragKey&&(this.multiDragKeyDown=!1)}},t(e,{pluginName:"multiDrag",utils:{select:function(e){var t=e.parentNode[F];t&&t.options.multiDrag&&!~st.indexOf(e)&&(ot&&ot!==t&&(ot.multiDrag._deselectMultiDrag(),ot=t),w(e,t.options.selectedClass,!0),st.push(e))},deselect:function(e){var t=e.parentNode[F],n=st.indexOf(e);t&&t.options.multiDrag&&~n&&(w(e,t.options.selectedClass,!1),st.splice(n,1))}},eventProperties:function(){var e=this,t=[],n=[];return st.forEach((function(o){var a;t.push({multiDragElement:o,index:o.sortableIndex}),a=dt&&o!==at?-1:dt?I(o,":not(."+e.options.selectedClass+")"):I(o),n.push({multiDragElement:o,index:a})})),{items:a(st),clones:[].concat(lt),oldIndicies:t,newIndicies:n}},optionListeners:{multiDragKey:function(e){return"ctrl"===(e=e.toLowerCase())?e="Control":1<e.length&&(e=e.charAt(0).toUpperCase()+e.substr(1)),e}}})}),Re}));var swapSortable,toastMain,toastVersion,MAX_TOOLS=12,autoScroll=!0,historyIndex=-1,swapTools=new Array(MAX_TOOLS),toolColors=new Array(MAX_TOOLS),isTestRunning=!1,boardOptions=new Array,hasMultiservo=!1,hasTmc=!1,hasV6S=!1,hasNeoPixels=!1,hasExtCtrl=!1,hasSharedStepper=!1,hasListState=!1,tmcStatusInterval=0,testCancelled=0,lastFWVersion=0,isShowingLoading=!1,isShowingUnloading=!1,plzWait="<br/>Please wait&hellip;",versionMismatch=new Array,uploadCancelled=!1,moveCarrierG1=!1,isFeederLoaded=!1,smuffIsIdle=!1,colorNames=[{label:"Aqua",value:0},{label:"Azure",value:0},{label:"Beige",value:0},{label:"Bisque",value:0},{label:"Black",value:0},{label:"Blue",value:0},{label:"Brown",value:0},{label:"BurlyWood",value:0},{label:"Chartreuse",value:0},{label:"Chocolate",value:0},{label:"Coral",value:0},{label:"Cornsilk",value:0},{label:"Crimson",value:0},{label:"Cyan",value:0},{label:"DimGray",value:0},{label:"FireBrick",value:0},{label:"Fuchsia",value:0},{label:"Gainsboro",value:0},{label:"Gold",value:0},{label:"Gray",value:0},{label:"Green",value:0},{label:"Honeydew",value:0},{label:"Indigo",value:0},{label:"Ivory",value:0},{label:"Khaki",value:0},{label:"Lavender",value:0},{label:"Lime",value:0},{label:"Linen",value:0},{label:"Magenta",value:0},{label:"Maroon",value:0},{label:"MintCream",value:0},{label:"MistyRose",value:0},{label:"Moccasin",value:0},{label:"Navy",value:0},{label:"Olive",value:0},{label:"Orange",value:0},{label:"Orchid",value:0},{label:"Pink",value:0},{label:"Plum",value:0},{label:"Purple",value:0},{label:"Red",value:0},{label:"Sienna",value:0},{label:"Silver",value:0},{label:"Tan",value:0},{label:"Turquoise",value:0},{label:"Transparent",value:0},{label:"Violet",value:0},{label:"White",value:0},{label:"Yellow",value:0}],materialNames=[{label:"PLA",value:0},{label:"PETG",value:0},{label:"PC",value:0},{label:"PA",value:0},{label:"ASA",value:0},{label:"ABS",value:0},{label:"CF",value:0},{label:"PVA",value:0},{label:"Flex",value:0},{label:"HIPS",value:0}];function initUI(){$("#swap-tools-template-container").addClass("hidden").removeClass("d-flex"),$("#materials-tool-template").addClass("hidden").removeClass("d-flex"),$("#history-items-template-container").addClass("hidden").removeClass("d-flex"),$("#console-templates").addClass("hidden").removeClass("d-flex"),$("#materials-template").addClass("hidden").removeClass("d-flex"),$("#servomap-template").addClass("hidden").removeClass("d-flex"),$("#sec-status, #sec-dashboard, #sec-settings, #sec-swaptools, #sec-statusinfo, #sec-testrun, #sec-boardinfo, #sec-live-control").fadeOut("fast"),$("#nav-container").addClass("hidden"),$("#test-status").addClass("hidden"),$("#tmc-status").addClass("hidden"),$("#tmc-stat-0").addClass("hidden"),$("#tmc-stat-1").addClass("hidden"),$("#tmc-stat-2").addClass("hidden"),$("#tmc-stat-3").addClass("hidden"),$("#toast-placement").addClass("hidden").removeClass("d-flex").removeClass("d-inline"),showChangesPending(!1),$("#tmcwarn-label").text(""),$("#version-label").text(""),$("#electronics-label").text(""),$("#mode-label").text(""),$("#console-text").text(""),$("#test-files").empty(),$("#test-files").append(new Option(localStorage.getItem("runningScript"),""))}function initUI2(){$("#relay-status").css("background-color",$(".card").css("color")),$("#relay-status").css("color",$(".card").css("background-color"))}function addSentGcode(e){if(null!=e){var t=$("#console-text-container"),n=$("#send-template").clone(!0);n.attr("id",""),n.removeClass("hidden"),n.text(e),t.append(n)}}async function addReceivedGcode(e){if(null!=e){$("#console-text-container span").length>3e3&&$("#console-text-container").find("span:first").remove();var t=$("#console-text-container"),n=$("#receive-template").clone(!0);n.attr("id",""),n.removeClass("hidden"),n.html(e),t.append(n),autoScroll&&t.scrollTop(t[0].scrollHeight)}}function createHistoryItem(e){if(null!=e){for(var t=0,n=$("#historyitemscontainer"),o=0;o<n.children().length;o++){var a=$(n.children()[o]).find("span").text();if(null!=a&&a.toUpperCase().trim()==e.toUpperCase().trim())return;t++}var i=$("#history-item-template").clone(!0),r=i.find("span");r.attr("id",""),i.find("i").attr("id",""),r.text(e),i.attr("id","history-item-"+t),i.css("cursor","pointer"),n.append(i)}}function showLoading(){if(!seenError){var e=$("#tool-selection").val();if(-1!=e)showInfo("<h2>Loading Filament for "+e+"</h2>"+plzWait),isShowingLoading=!0;$("#feeder-pwr-off").addClass("hidden")}}function showUnloading(){if(!seenError){var e=$("#tool-selection").val();if(-1!=e)showInfo("<h2>Unloading Filament from "+e+"</h2>"+plzWait),isShowingUnloading=!0;$("#feeder-pwr-off").addClass("hidden")}}function showPurging(e){if(""!=e){var t=e.matchAll(/([A-Z]:)(\d+.?\d*)/g),n=-1,o=0,a=0;for(const e of t)switch(e[1]){case"T:":n=parseInt(e[2]);break;case"L:":o=parseInt(e[2]);break;case"C:":a=parseFloat(e[2])}if(-1!=n){var i="<h2>Purging Tool "+n+"</h2>Amount: "+o+" mm or "+a+" mm³<br/>"+plzWait;setTimeout((function(){showInfo(i)}),500)}}else cancelInfo()}$(document).ready((function(){$.get("fwversion.txt",(function(e){console.log("Lastest SMuFF Firmware version: "+e),lastFWVersion=parseFloat(e)}));var e=$('<link href="'+$("#themes").val()+'" rel="stylesheet" />');if(e.appendTo("head"),null!=localStorage.getItem("Theme")){var t=localStorage.getItem("Theme");$("#themes").val(t),e.attr("href",t).promise().done((function(){initUI(),setTimeout((function(){initUI2()}),1e3)}))}else initUI(),initUI2();for(var n=0;n<3;n++)versionMismatch[n]=0;$("#themes").on("change",(function(){e.attr("href",$(this).val()).promise().done((function(){setTimeout((function(){initUI2()}),1e3)})),localStorage.setItem("Theme",$(this).val())}));var o=[].slice.call(document.querySelectorAll(".toast")).map((function(e){return new bootstrap.Toast(e)}));toastVersion=o[0],toastMain=o[1],swapSortable=Sortable.create(toolsswaplist,{swap:!0,swapClass:"swapping-highlight",animation:250,store:{get:function(e){},set:function(e){var t=swapSortable.toArray(),n=0;t.forEach((function(e){swapTools[n++]=parseInt(e.substring(3))}))}}});var a,i=Sortable.create(historyitemscontainer,{swap:!1,swapClass:"swapping-highlight",animation:250,store:{get:function(){var e=localStorage.getItem("CmdHistory");if(void 0!==e){var t=JSON.parse(e);null!=t&&t.forEach((function(e){createHistoryItem(e)}))}},set:function(){for(var e="[ ",t=$("#historyitemscontainer"),n=0;n<t.children().length;n++){e+='"'+$(t.children()[n]).find("span").text()+'"',n<t.children().length-1&&(e+=",")}e+=" ]",localStorage.setItem("CmdHistory",e),showToast("History has been saved locally.")}}});$("#accordion-settings input, #accordion-settings select").on("change",(function(){if(showChangesPending(!0),$(this).hasClass("form-check-input")){var e=$(this).prop("checked");switch($(this).prop("id")){case"UsePurge":setCheckmark($("#card-purge"),e);break;case"SendStats":setCheckmark($("#card-sendstat"),e);break;case"Revolver-UseServo":e&&$("#Revolver-TMC-Mode").val(0).trigger("change");break;case"UseCutter":e?$("#lvc-cutter").removeClass("visually-hidden"):$("#lvc-cutter").addClass("visually-hidden")}checkForChange($(this))&&sendChange($(this)),"EmulPrusa"==$(this).prop("id")&&sendGcode("M115",!1,!1)}})),$("#accordion-settings input").on("focusout",(async function(){showChangesPending(!0),checkForChange($(this))&&(sendChange($(this)),"Revolver-ServoClose"==$(this).prop("id")&&$("#servo-closed-modal").modal("show"))})),$("#accordion-settings select").on("change",(async function(){showChangesPending(!0),checkForChange($(this))&&sendChange($(this))})),$("#console-container").on("hide.bs.collapse",(function(){$("#console-toggle-icon").toggleClass("down"),localStorage.setItem("Console","closed")})),$("#console-container").on("show.bs.collapse",(function(){$("#console-toggle-icon").toggleClass("down"),localStorage.setItem("Console","opened")})),$("#toast-placement").on("hide.bs.toast",(function(){$(this).addClass("hidden").removeClass("d-inline").removeClass("d-flex"),$(this).find(".toast").each((function(){$(this).removeClass("d-flex")}))})),$("#toast-placement").on("show.bs.toast",(function(){$(this).removeClass("hidden").addClass("d-inline").addClass("d-flex"),$(this).find(".toast").each((function(){$(this).addClass("d-flex")}))})),"closed"==localStorage.getItem("Console")&&$("#console-container").toggleClass("show"),$("#btn-selector-settings").trigger("click"),$("#btn-settings-general").trigger("click"),$("#connect, #connecting-message, #smuff-image").on("click",(function(){"serial"in navigator?($("#connecting-message").fadeOut("slow",(function(){$("#connecting-message").text("Connecting with SMuFF, please pick a serial port...").fadeIn()})),connectSerial()):(showToast("Your browser doesn't support Web Serial! Please try a different browser&hellip;"),$("#connecting-message").html("Connection failed!"))})),$(".navbar-nav#main .nav-item").on("click",(async function(){var e=$(this).data("section");void 0!==e&&("#disconnect"==e?(await disconnectSerial(),showConnect()):($("li.nav-item").removeClass("activeSection"),$(this).addClass("activeSection"),$(".section:not("+e+")").hide(),$(e).fadeIn("slow"),"#sec-statusinfo"==e?0==tmcStatusInterval&&(tmcStatusInterval=setInterval((function(){refreshTMCStats()}),750)):0!=tmcStatusInterval&&(clearInterval(tmcStatusInterval),tmcStatusInterval=0)))})),$("#console-text-container").on("scroll",(function(){autoScroll=$(this).scrollTop()+$(this).height()>=$(this)[0].scrollHeight})),$(".remove-history-entry").on("click",(function(){$(this).parent().remove()})),$("#gcode").keypress((function(e){13==e.which&&$("#btn-send-gcode").trigger("click")})),$("#gcode").keydown((function(e){var t=$("#historyitemscontainer");38==e.which&&(e.preventDefault(),--historyIndex<0&&(historyIndex=t.children().length-1),setGcodeHistory()),40==e.which&&(e.preventDefault(),++historyIndex>=t.children().length&&(historyIndex=0),setGcodeHistory())})),$("body").on("keydown",(function(e){var t=e.keyCode||e.which;t>=112&&t<=115&&(e.preventDefault(),sendPFKey(t-32))})),$("#version-info, #release-notes").on("click",(function(){$("#recent-changes-modal").modal("show")})),$("#logo, #smuff").on("click",(function(){location.href="https://sites.google.com/view/the-smuff/"})),$("#btn-send-gcode").on("click",(async function(){var e=$("#gcode").val();null!=e&&e.length>0&&(createHistoryItem(e),sendGcode(e,!0,!0),await getResponse(),historyIndex=-1),$("#gcode").val("")})),$("#btn-clear-gcode").on("click",(function(){$("#console-text-container").empty()})),$("#btn-pf1").on("click",(function(){sendPFKey(80)})),$("#btn-pf2").on("click",(function(){sendPFKey(81)})),$("#btn-pf3").on("click",(function(){sendPFKey(82)})),$("#btn-pf4").on("click",(function(){sendPFKey(83)})),$("#btn-home").on("click",(function(){sendGcode("G28",!0,!0),moveCarrierG1=!1})),$("#btn-motors-off").on("click",(function(){sendGcode("M18",!0,!0)})),$("#btn-tool-maint").on("click",(function(){sendGcode("TM",!0,!0)})),$("#btn-wipe").on("click",(function(){sendGcode("G12",!0,!0)})),$("#btn-cut").on("click",(function(){sendGcode("G12C",!0,!0)})),$("#btn-load").on("click",(function(){sendGcode("M700",!0,!0),showLoading()})),$("#btn-unload").on("click",(function(){sendGcode("M701",!0,!0),showUnloading()})),$("#btn-reset").on("click",(function(){sendGcode("M999",!0,!0)})),$("#btn-view-script").on("click",(async function(){var e=$("#test-files option:selected").text();""!=e&&(sendGcode('M20L"test/'+e+'.gcode"'),await getResponse(),""!=responseBuffer&&($("#script-name").text(e),$("#script-content").val(responseBuffer),$("#view-script-modal").modal("show")))})),$("#btn-run-test").on("click",(async function(){var e;if("stopped"==$(this).data("state")){var t=$("#test-files option:selected").text();localStorage.setItem("runningScript",t),sendGcode('M98P"'+t+'"',!0,!1),await getResponse(),e=!0,testCancelled=0}else localStorage.setItem("runningScript",""),sendChar(""),e=!1,testCancelled=(new Date).getTime();showTestRunning(e)})),$("#btn-save-settings").on("click",(function(){showToast("Saving Settings&hellip;"),saveConfig(),removeValFeedback()})),$("#btn-reload-settings").on("click",(function(){showToast("Reloading Settings&hellip;"),requestInit(),removeValFeedback()})),$("#btn-reset-swaps").on("click",(function(){var e=swapSortable.toArray();e.sort(),swapSortable.sort(e,!0),swapSortable.save()})),$("#btn-save-swaps").on("click",(async function(){for(var e="{ ",t=0;t<swapTools.length;t++)e+="''T"+t+"'': "+swapTools[t],t<swapTools.length-1&&(e+=",");sendGcode('M504P"Swaps"S"'+(e+=" }")+'"',!1,!1),await getResponse()&&showToast("Tool-Swaps have been saved.")})),$("#btn-save-history").on("click",(function(){i.save()})),$("#btn-copy-to-clipboard").on("click",(async function(){var e="";$("#console-text-container span").each((function(){""!=$(this).text()&&($(this).hasClass("data-sent")&&(e+="[--- "),e+=$(this).text().replaceAll("\n",""),$(this).hasClass("data-sent")?e+=" ---]\n":e+="\n")})),await navigator.clipboard.writeText(e),showToast("Console output copied to Clipboard.")})),$("#firmware-file").on("change",(function(e){1==e.target.files.length?($("#btn-upload-firmware").removeClass("disabled"),$("#btn-upload-firmware").prop("disabled",!1),a=e.target.files[0]):($("#btn-upload-firmware").addClass("disabled"),$("#btn-upload-firmware").prop("disabled",!0),a=null)})),$("#btn-upload-firmware").on("click",(function(){if(console.log(a),null!=a){var e=new FileReader;e.onerror=function(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:showToast("File Not Found!");break;case e.target.error.NOT_READABLE_ERR:ahowToast("File is not readable!");break;case e.target.error.ABORT_ERR:break;default:showToast("An error occurred reading this file.")}fwBuffer=null},e.onprogress=async function(e){e.loaded==e.total&&(await sendUploadRequest("firmware.tmp",e.total),console.log("file loaded completely"))},e.onabort=function(e){showToast("Firmware upload aborted!"),fwBuffer=null},e.onloadstart=function(e){console.log(e.srcElement.readyState)},e.onload=async function(t){console.log(t.currentTarget.result),t.currentTarget.readyState==e.DONE&&($("#firmware-upload-modal").modal("show"),fwBuffer=new Uint8Array(t.currentTarget.result),setTimeout((function(){sendBuffer(fwBuffer)}),500))},e.readAsArrayBuffer(a)}})),$("#btn-modal-ok").on("click",(async function(){$("#restart-modal").modal("hide"),sendGcode("M999"),await getResponse()})),$("#btn-modal-wipe-ok").on("click",(async function(){$("#wipe-sequence-modal").modal("hide");var e="S"+$("#wipe-S").val()+"I"+$("#wipe-I").val()+"J"+$("#wipe-J").val()+"P"+$("#wipe-P").val()+"R"+$("#wipe-R").val();$("#WipeSeq").val(e),sendChange($("#WipeSeq"))})),$("#btn-servo-ok").on("click",(function(){$("#servo-closed-modal").modal("hide");var e=$("#Revolver-ServoClose").val();$('input[id^="Close-"]').each((async function(){$(this).val(e).trigger("focusout"),await getResponse()}))})),$("#btn-cancel-upload").on("click",(function(){uploadCancelled=!0})),$("#card-relay").on("click",(async function(){if(hasSharedStepper&&!isTestRunning){var e="I"==$(this).find("span#state").data("state")?"E":"I";$(this).find("span#state").data("state",e),setRelayState(e),sendGcode("M17"+e,!0,!1),await getResponse()}})),$("#card-lid").on("click",(async function(){if(!isTestRunning){var e="0"==$(this).find("i").data("state")?"1":"0";hasListState||setLidIcon(e),sendGcode("M280R"+e,!0,!1),await getResponse()}})),$("#card-purge").on("click",(async function(){if(!hasExtCtrl&&!isTestRunning){var e="0"==$(this).find("i").data("state")?"1":"0";setCheckmark(this,e),sendGcode('M205P"UsePurge"S'+e,!0,!1),await getResponse(),sendGcode("M503S1W",!1,!1),await getResponse()}})),$("#card-sendstat").on("click",(async function(){if(!isTestRunning){var e="0"==$(this).find("i").data("state")?"1":"0";setCheckmark(this,e),sendGcode('M205P"SendStats"S'+e,!0,!1),await getResponse(),sendGcode("M503S1W",!1,!1),await getResponse()}})),$("#tmc-status").on("click",(function(){$('.nav-item[data-section="#sec-statusinfo"]').trigger("click")})),$("#tool-selection").on("change",(async function(){if(moveCarrierG1=!1,$("#selector-pwr-off").addClass("hidden"),-1==$(this).val())sendGcode("G28X",!0,!1),moveCarrier(0),await getResponse();else{var e=parseInt($(this).val().substring(1));sendGcode($(this).val(),!0,!1),moveCarrier(e),await getResponse()}})),$("[id^=history-item-]").on("click",(function(){$("#gcode").focus(),$("#gcode").val($(this).find("span").text())})),$("#WipeSeq").on("focus, click",(function(){var e=$(this).val().matchAll(/([a-zA-Z]\d{1,3})/g);for(const t of e)console.log(t[0]),$("#wipe-"+t[0].toUpperCase()[0]).val(t[0].substring(1));$("#wipe-sequence-modal").modal("show")})),$("#Revolver-ServoClose").on("change",(async function(){initDone&&(sendGcode('M205P"ServoClose"S'+$(this).val()+"I99"),await getResponse())})),$("#Revolver-ServoOpen").on("change",(async function(){initDone&&(sendGcode('M205P"ServoOpen"S'+$(this).val()+"I99"),await getResponse())}))}));var tmcStatusBusy=!1;async function refreshTMCStats(){!tmcStatusBusy&&initDone&&(tmcStatusBusy=!0,$("#tmc-stat-0").hasClass("hidden")||(sendGcode("M122W0"),await getResponse()),$("#tmc-stat-1").hasClass("hidden")||(sendGcode("M122W1"),await getResponse()),$("#tmc-stat-2").hasClass("hidden")||(sendGcode("M122W2"),await getResponse()),$("#tmc-stat-3").hasClass("hidden")||(sendGcode("M122W3"),await getResponse()),tmcStatusBusy=!1)}function showTestRunning(e){if(!(1==e&&testCancelled>0&&(new Date).getTime()-testCancelled<4e3)){var t=$("#btn-run-test"),n=$("#test-status"),o=localStorage.getItem("runningScript");e?"running"!=t.data("state")&&(t.data("state","running"),t.find("i").removeClass("fa-play"),t.find("i").addClass("fa-stop"),n.removeClass("hidden"),n.html('Test <i>"'+o+'"</i> is running&hellip;'),isTestRunning=!0,$('.nav-item[data-section="#sec-dashboard"]').addClass("hidden"),$('.nav-item[data-section="#sec-live-control"]').addClass("hidden"),$('.nav-item[data-section="#sec-settings"]').addClass("hidden"),$('.nav-item[data-section="#sec-swaptools"]').addClass("hidden"),$('.nav-item[data-section="#sec-statusinfo"]').addClass("hidden"),setDisabled(!0,".sec-status"),$("#sec-status").hide("slow")):"stopped"!=t.data("state")&&(t.data("state","stopped"),t.find("i").removeClass("fa-stop"),t.find("i").addClass("fa-play"),n.addClass("hidden"),n.text(n.text().replace(o,"{TEST}")),isTestRunning=!1,$('.nav-item[data-section="#sec-dashboard"]').removeClass("hidden"),$('.nav-item[data-section="#sec-live-control"]').removeClass("hidden"),$('.nav-item[data-section="#sec-settings"]').removeClass("hidden"),$('.nav-item[data-section="#sec-swaptools"]').removeClass("hidden"),hasTmc&&$('.nav-item[data-section="#sec-statusinfo"]').removeClass("hidden"),setDisabled(!1,".sec-status"),$("#sec-status").show("slow"))}}function setCheckmark(e,t){var n=$(e).find("i");n.data("state",t),"send-stat"!=n.prop("id")?(n.removeClass("fa-check-circle fa-times-circle"),n.addClass("0"==t?"fa-times-circle":"fa-check-circle")):(n.removeClass("fa-repeat fa-times-circle fa-spin"),n.addClass("0"==t?"fa-times-circle":"fa-repeat fa-spin"))}function hideConnect(){$("#sec-start").fadeOut("slow").promise().done((function(){$("#sec-dashboard, #sec-status").fadeIn("fast"),$('li.nav-item[data-section="#sec-dashboard"]').addClass("activeSection"),$('li.nav-item[data-section!="#sec-dashboard"]').removeClass("activeSection")})),$("#nav-container").removeClass("hidden")}function showConnect(){$("#sec-status, #sec-dashboard, #sec-settings, #sec-swaptools, #sec-statusinfo, #sec-testrun, #sec-live-control").fadeOut("fast").promise().done((function(){$("#sec-start").fadeIn("fast"),$("#connecting-message").text("Disconnected...").fadeIn("slow"),setTimeout((function(){$("#connecting-message").fadeOut("slow",(function(){$("#connecting-message").text("Click here to connect...").fadeIn("slow")}))}),2e3)})),$("#nav-container").addClass("hidden")}async function sendChange(e){if(initDone){var t=buildM205Command(e);if(""!=t){e.removeClass("val-failed"),sendGcode(t);var n=await getResponse();e.addClass(n?"val-changed":"val-failed"),n||showToast("Setting this value on the SMuFF has failed!<br/><br/>Please check console output for detailed information.")}}}function setValue(e,t){for(var n of Object.keys(e)){var o,a=!1;t.indexOf("${key}")>-1?(o=t.replace("${key}",n),a=!0):o=t;var i=$("#"+o+(a?"":n));if(null!=i){if("checkbox"==i.prop("type")){var r,s;if("boolean"==typeof e[n])switch(r=e[n],e[n]){case!0:s="Yes";break;case!1:s="No"}else switch(e[n]){case 1:r=!0,s="HIGH";break;case 0:r=!1,s="LOW"}i.prop("checked",r),i.attr("data-bs-original-title",s)}else"color"==i.prop("type")?i.val("#"+e[n]):i.val(e[n]);i.trigger("change")}else console.log("Control #"+n+" not found!");0}}function setTMCstats(e){var t=0,n=e.TMCStatus.Axis;if(1==e.TMCStatus.InUse)for(var o of($("#tmc-stat-"+n).removeClass("hidden"),Object.keys(e.TMCStatus))){var a=$("#tmc-stat-"+n+"-"+o);"Version"==o&&(parseInt(e.TMCStatus[o])<1?versionMismatch[n]++:versionMismatch[n]>0&&versionMismatch[n]--),versionMismatch[n]>10&&(showToast("Version mismatch on TMC driver!<br/>Please check your hardware setup!"),$("#tmc-status").removeClass("hidden")),a.text(e.TMCStatus[o]),void 0!==a.parent().data("alert")&&("No"!=a.text()?(a.addClass("tmc-warning"),$("#tmc-status").removeClass("hidden")):a.removeClass("tmc-warning"))}else $("#tmc-stat-"+n).addClass("hidden"),t++;4==t&&(hasTmc=!1,hideStatusInfoNav())}function setSettings(e,t){var n;try{if(n=JSON.parse(e),"TMC"==t&&(localStorage.setItem("TMC",e),setTMCstats(n)),"Basic"==t&&(localStorage.setItem("M503S1",e),setValue(n,""),setValue(n.Baudrates,"baudrate-")),"Steppers"==t&&(localStorage.setItem("M503S2",e),setValue(n.Selector,"Selector-"),setValue(n.Revolver,"Revolver-"),setValue(n.Feeder,"Feeder-")),"TMC Driver"==t&&(localStorage.setItem("M503S3",e),setValue(n.Selector,"Selector-TMC-"),setValue(n.Revolver,"Revolver-TMC-"),setValue(n.Feeder,"Feeder-TMC-")),"Servo mapping"==t){localStorage.setItem("M503S4",e);for(var o=getToolCount(),a=0;a<o;a++)setValue(n["T"+a],"servomap-"+a+' [id="${key}-'+a+'"]');setValue(n.Wiper,"servomap-"+(o+1)+' [id="${key}-Wiper"]')}if("Materials"==t){localStorage.setItem("M503S5",e);o=getToolCount();toolColors=new Array(o);for(a=0;a<o;a++)setValue(n["T"+a],"materials-tool-"+a+' [id="${key}-'+a+'"]'),toolColors[a]=$("#materials-tool-"+a+' [id="Color-'+a+'"]').val()}if("Tool swaps"==t){localStorage.setItem("M503S6",e);for(a=0;a<MAX_TOOLS;a++)swapTools[a]=n["T"+a];setupSwaps()}t=""}catch(e){return console.log(e),void showToast("Failed to read settings from SMuFF. Please check your setup!")}}function addTestFiles(e){try{var t=JSON.parse(e);$("#test-files").empty(),null!=t&&t.forEach((function(e){var t=e.indexOf(".gcode");if(-1!=t){var n=e.substring(0,t);$("#test-files").append(new Option(n,""))}}))}catch(e){console.log(e),showToast('Can\'t read test-files from SMuFF. Please check the "test" folder on your SD-Card!')}}function setRelayState(e){var t=e.substring(0,1),n=$("#card-relay").find("span#state");n.data("state",t),n.text(t)}function setFWInfo(e){hasTmc=!1,hasV6S=!1,hasMultiservo=!1;try{var t=e.split(":"),n=t[3].replace(" DATE","").trim();$("#version-label").text(t[2].replace(" ELECTRONICS","")),$("#electronics-label").text(n),$("#mode-label").text(t[5].replace(" OPTIONS",""));try{if(t.length>5){console.log("Options: "+t[6]),$("#electronics-label").prop("title",t[6].replaceAll("|","; ")),boardOptions=t[6].split("|"),hasNeoPixels=!1,setDisabled(!0,".hasNeopixels"),setDisabled(!0,".hasBacklight"),setDisabled(!0,".hasTMC"),setDisabled(!0,".hasV6S"),setDisabled(!1,".hasNotV6S");for(var o=0;o<boardOptions.length;o++)boardOptions[o]=boardOptions[o].trim(),addSentGcode(boardOptions[o]),"MULTISERVO"==boardOptions[o]&&(hasMultiservo=!0),"TMC"==boardOptions[o]&&(hasTmc=!0,setDisabled(!1,".hasTMC")),"V6S"==boardOptions[o]&&(hasV6S=!0,setDisabled(!1,".hasV6S"),setDisabled(!0,".hasNotV6S")),"NEOPIXELS"==boardOptions[o]&&(hasNeoPixels=!0,setDisabled(!1,".hasNeopixels")),boardOptions[o].startsWith("MINIPANEL V2")&&setDisabled(!1,".hasBacklight");hasV6S||($("#tmc-mode-revolver").addClass("hidden").removeClass("d-flex"),$("#tmc-section-revolver").addClass("hidden").removeClass("d-flex"))}}catch(e){console.log(e)}try{n=n.replaceAll(" ","_"),$("#pins-image").prop("src","assets/img/"+n+".png"),$("#wiring-image").prop("src","assets/img/"+n+"_Wiring.png")}catch(e){hideBoardInfoNav()}hideStatusInfoNav();var a=parseFloat($("#version-label").text().trim().substring(1));if(a<2.26){$("#version-label").addClass("version-warning");var i="This SMuFF-Firmware version is outdated for this app! Install at least version 2.26";$("#version-label").prop("title",i),showToast(i)}a<lastFWVersion&&($("#latest-version-info").text(lastFWVersion),setTimeout((function(){toastVersion.show()}),3e3))}catch(e){console.log(e)}}function hideStatusInfoNav(){hasTmc||$('.nav-item[data-section="#sec-statusinfo"] .nav-link').addClass("hidden")}function hideBoardInfoNav(){hasTmc||$('.nav-item[data-section="#sec-boardinfo"] .nav-link').addClass("hidden")}function setStatus(e){var t=e.substring(14),n=0;hasListState=!1;var o=t.matchAll(/([A-Z]{1,3}[\d|:]+).(\w+|-?\d+)+/g);for(const e of o){var a="on"==e[2];switch(e[1]){case"T:":$("#tool-selection").val(e[2]),n=e[2];break;case"S:":setCheckmark($("#card-selector"),a),setSelectorLed(a);break;case"R:":setCheckmark($("#card-revolver"),a);break;case"F:":setCheckmark($("#card-feed1"),a),isFeederLoaded=a,setFeederLed(a);break;case"F2:":setCheckmark($("#card-feed2"),a);break;case"SD:":a?showSDWarning():cancelSDWarning();break;case"SC:":a&&setTimeout((function(){$("#btn-reload-settings").trigger("click")}),2e3);break;case"LID:":setLidIcon(a),hasListState=!0;break;case"I:":smuffIsIdle=a}}n=getCurrentTool(),moveCarrierG1||(smuffIsIdle||($('[id^="lvc-led-"]').each((function(){$(this).prop("id").endsWith(n)||setToolLed($(this),!1)})),-1!=n&&setToolLed($("#lvc-led-"+n),!0)),moveCarrier(-1==n?0:n)),setIdleAnimation(smuffIsIdle)}function moveCarrier(e){var t=$("#lvc-slot-template").width(),n=$("#lvc-carrier").width();$("#lvc-carrier").css("right",n+e*t+"px")}function setToolLed(e,t,n,o){if(t){var a=$("#ToolColor").find(":selected").text();void 0!==n&&(a=n),$(e).css("opacity",1),$(e).css("background-color",a).fadeIn(smuffIsIdle?"fast":"slow")}else{if(hasNeoPixels)var i=0;void 0!==o?(i=parseFloat($(e).css("opacity"))-o,$(e).css("opacity",i<0?0:i)):$(e).css("opacity",0).fadeOut("fast")}}var idleAnimTimer=0;function setIdleAnimation(e){if(""!=$("#AnimBPM").val()&&hasNeoPixels){var t=getToolCount();if(-1!=t){var n=60/$("#AnimBPM").val()*1e3/t/2,o=getCurrentTool(),a=0,i=!0;e?$("#IdleAnim").is(":checked")&&0==idleAnimTimer&&(idleAnimTimer=setInterval((async function(){o,o==t-1&&i?(i=!1,await sleep(n)):0!=o||i||(i=!0,await sleep(n)),i?o++:o--;var e="hsl("+a+",80%,50%);";$('[id^="lvc-led-"').each((function(){setToolLed($(this),!1,null,.25)})),setToolLed($("#lvc-led-"+o),!0,e),(a+=5)>360&&(a=0)}),n)):(0!=idleAnimTimer&&clearInterval(idleAnimTimer),idleAnimTimer=0)}}}function setTestResults(e){try{var t=JSON.parse(e.substring(15));$("#tst-elapsed").text(t.Elapsed),$("#tst-loopcnt").text(t.Loops),$("#tst-cmdcnt").text(t.Cmds),$("#tst-changes").text(t.ToolChanges),$("#tst-feederr").text(t.FeederErrors),$("#tst-stallselector").text(t.SelectorStalls),$("#tst-stallfeeder").text(t.FeederStalls);for(var n=t.FeedsOk.split("|"),o=t.FeedsMissed.split("|"),a=0;a<n.length;a++){var i=n[a].trim(),r=o[a].trim();i.length>0&&$("#tst-ok-"+a).text(i),r.length>0&&$("#tst-fail-"+a).text(r)}}catch(e){console.log(e)}}function showToast(e){$("#toast-message").html(e),toastMain.show()}function showInfo(e){$("#info-message").html(e),$("#info-modal").modal("show")}function cancelInfo(){$("#info-modal").modal("hide")}function showError(e){$("#serious-error-message").html(e),$("#serious-error-modal").modal("show")}function cancelError(){$("#serious-error-modal").modal("hide")}function showSDWarning(){$("#sd-warning").modal("show")}function cancelSDWarning(){$("#sd-warning").modal("hide")}function showChangesPending(e){e?$("#changes-pending").show():$("#changes-pending").hide(),changesPending=e}function replaceId(e){return e=(e=(e=(e=e.replace("Selector-","")).replace("Feeder-","")).replace("Revolver-","")).replace("TMC-","")}function normalizeId(e){var t=-1;return e.startsWith("Material-")&&(t=e.substring(9),e=e.substring(0,8)),e.startsWith("Color-")&&(t=e.substring(6),e=e.substring(0,5)),e.startsWith("PFactor-")&&(t=e.substring(8),e=e.substring(0,7)),e.startsWith("CValue-")&&(t=e.substring(7),e=e.substring(0,6)),e.startsWith("Close-")&&(t=e.substring(6),e=e.substring(0,5)),e.startsWith("Output-")&&(t=e.substring(7),e=e.substring(0,6)),e.startsWith("baudrate-")&&(t=e.substring(9),e=t),[e,t]}function buildM205Command(e){var t,n=e.prop("id");if("M"==n&&"C"==n&&"CV"==n&&"PF"==n&&"O"==n&&"P"==n)return"";var o=e.prop("localName"),a=e.prop("type"),i=(e.attr("data-section"),e.attr("data-subsection"));if(""==n&&console.log(">>> No ID <<< for prop: "+o+" of type: "+a),"input"!=o&&"select"!=o||(t="text"==a?'"'+e.val()+'"':"color"==a?'"'+e.val().substring(1)+'"':"checkbox"==a?e.is(":checked")?1:0:isNaN(e.val())?null:e.val()),null!=t){const e=normalizeId(n=replaceId(n));n.startsWith("baudrate-")?(n="Baudrates",t='"'+t+'"'):n=e[0],idx=e[1];var r="";if(void 0!==i)switch(i){case"Selector":r="X";break;case"Revolver":r="Y";break;case"Feeder":r="Z"}return'M205P"'+n+'" S'+t+" "+r+(-1!=idx?"I"+idx:"")}return console.log("Skipping null value..."),""}function checkForChange(e){var t=replaceId(e.attr("id"));const n=normalizeId(t);t=n[0],idx=n[1];var o,a,i=e.attr("data-section"),r=e.attr("data-subsection"),s="checkbox"==e.prop("type"),l=JSON.parse(localStorage.getItem("M503"+i)),c="";if(void 0!==(c=void 0!==r?l[r][t]:l[t])){if(s?(e.tooltip("hide"),1==e.prop("checked")?"boolean"==typeof c?(o=!0,a="Yes"):(o=1,a="HIGH"):"boolean"==typeof c?(o=!1,a="No"):(o=0,a="LOW"),e.attr("data-bs-original-title",a),e.attr("aria-label",a)):o=e.val(),c!=o)try{return void 0!==r?l[r][t]=o:l[t]=o,localStorage.setItem("M503"+i,JSON.stringify(l)),!0}catch(e){console.log(e)}}else showToast("WTF? val undefined?! id: <b>"+t+"</b> subsection: <b>"+r+"</b>"),console.log("val undefined?!");return!1}async function saveConfig(){sendGcode("M500"),getResponse()&&($("#restart-modal").modal("show"),showChangesPending(!1))}function removeValFeedback(){$("#accordion-settings input, #accordion-settings select").each((function(){$(this).removeClass("val-changed"),$(this).removeClass("val-failed")}))}function setGcodeHistory(){if(-1!=historyIndex){var e=$($("#historyitemscontainer").children())[historyIndex],t=$(e).find("span").text();$("#gcode").val(t),setTimeout((function(){$("#gcode").focus()}),100)}}function setLidIcon(e){var t=$("#card-lid").find("i");t.data("state",e),t.removeClass("fa-unlock fa-lock"),t.addClass("0"==e?"fa-unlock":"fa-lock"),setServoHorn(e)}function getCurrentTool(){var e=$("#tool-selection").val();return"-1"==e?-1:null!=e?parseInt(e.substring(1)):-1}function setServoHorn(e){var t=parseInt($("#Revolver-ServoOpen").val()),n=parseInt($("#Revolver-ServoClose").val()),o=getCurrentTool();-1!=o&&(n=parseInt($("#Close-"+o).val()));var a=e?90-n:90-t;if(!isNaN(a))if($("#lvc-horn").css({transform:"rotate("+a+"deg)"}),"#sec-live-control"==$(".nav-item.activeSection").data("section")){var i=e?n:t;$("#lvc-horn-image").attr("data-bs-original-title",i+" deg").tooltip("update")}else $("#sec-live-control .tooltip").each((function(){$(this).tooltip("hide")}))}async function recalculateSpeeds(){if(initDone){for(var e=[["Selector-MaxSpeed","X"],["Selector-AccelSpeed","X"],["Revolver-MaxSpeed","Y"],["Revolver-AccelSpeed","Y"],["Feeder-MaxSpeed","Z"],["Feeder-AccelSpeed","Z"],["Feeder-InsSpeed","Z"],["Feeder-PurgeSpeed","Z"]],t=0;t<e.length;t++){var n=$("#"+e[t][0]).val();if(""!=n)sendGcode('M205P"XlateSpeed"S'+n+e[t][1]),await getResponse()&&$("#"+e[t][0]).val(parseInt(xlatedSpeed));else console.log('Speed "'+e[t]+'" is not set!')}showToast("Speeds have been translated! Please check whether they were calculated correctly.")}}function setDisabled(e,t){var n=$(t+" input,"+t+" select"),o=$(t+" label,"+t+" span, "+t+" i, "+t+" div");e?(n.attr("disabled","disabled"),n.css("opacity","0.5"),o.css("opacity","0.5")):(n.removeAttr("disabled"),n.css("opacity","1"),o.css("opacity","1"))}function setAutocompleteColors(e){new Autocomplete(e,{data:colorNames,maximumItems:5,treshold:1});$(e).on("focusout",(function(){$(this).parent().find()}))}function setAutocompleteMaterials(e){new Autocomplete(e,{data:materialNames,maximumItems:5,treshold:1})}async function sendUploadRequest(e,t){if(sendGcode('M997 P"/'+e+'" L'+t),!await getResponse())return showToast("Uploading firmware failed! See console for details."),!1;uploadCancelled=!1}async function sendUploadStart(){return sendGcode(String.fromCharCode(27,85),!1,!1),!!await getResponse()||(showToast("SMuFF not responding. Aborting upload!"),!1)}async function sendBuffer(e){for(var t=e.length,n=0;n<t;n++){await sendChar(String.fromCharCode(e[n]));var o=parseFloat(n/t*100);if($("#progress-upload .progress-bar").css("width",o+"%"),uploadCancelled)break;pauseTransmission&&await getResume()}$("#firmware-file").val(""),setTimeout((function(){$("#firmware-upload-modal").modal("hide")}),2e3)}const MAX_CFG_INDEX=15;var port,textEncoder,writableStream,writer,readableStream,reader,nextCfgIndex=-1,initDone=!1,seenOk=!1,seenError=!1,prevLine="",configType="",currentSerial=-1,xlatedSpeed=0,collectResponse=!1,responseBuffer="",isPurging=!1,isBooting=!1,booting="<h2>SMuFF is booting&hellip;</h2>",pauseTransmission=!1;function sleep(e){return new Promise(t=>setTimeout(t,e))}function getResponse(){return new Promise(e=>gotOk(e))}function getResume(){return new Promise(e=>gotXon(e))}async function gotOk(e){for(var t=1e4;!seenOk;)await sleep(10),(t-=10)<=0&&e(!1);collectResponse=!1,isPurging=!1,e(!seenError)}async function gotXon(e){for(var t=1e4;pauseTransmission;)await sleep(10),(t-=10)<=0&&e(!1);e(!0)}async function sendGcode(e,t,n,o=!0){console.log("Gcode: "+e),seenOk=seenError=!1,0!=e.length&&(e.trim().toUpperCase().startsWith("M20L")&&(responseBuffer="",collectResponse=!0),e.trim().toUpperCase().startsWith("G1")&&(e.toUpperCase().indexOf("X")>-1&&$("#selector-pwr-off").addClass("hidden"),e.toUpperCase().indexOf("Z")>-1&&$("#feeder-pwr-off").addClass("hidden")),await writer.write(e+(o?"\r\n":"")),t&&addSentGcode(e),n&&$("#gcode").focus())}async function sendChar(e){await writer.write(e)}function sendCharSync(e){writer.write(e)}function sendPFKey(e){var t=String.fromCharCode(27,91,79,e);console.log("Seq: "+t),addSentGcode("[PF"+String.fromCharCode(e-31,93)),sendGcode(t,!1,!0)}async function disconnectSerial(){reader&&(await reader.cancel(),await readableStream.catch(()=>{}),reader=null,readableStream=null),writer&&(await writer.close(),await writableStream,writer=null,writableStream=null),port&&(await port.close(),port=null)}async function connectSerial(e=115200){try{port=await navigator.serial.requestPort(),await port.open({baudRate:e}),textEncoder=new TextEncoderStream,writableStream=textEncoder.readable.pipeTo(port.writable),writer=textEncoder.writable.getWriter(),nextCfgIndex=0,listenToSerial(),isTestRunning?isTestRunning&&setTimeout((function(){$(".nav-item.activeSection").removeClass("activeSection"),$('.nav-item[data-section="#sec-testrun"]').trigger("click")}),500):setTimeout((async function(){await requestInit()?hideConnect():(await disconnectSerial(),showConnect())}),750)}catch{$("#connecting-message").text("Serial Connection Failed!")}}async function sendInitSeq(e){var t=5,n=!1;do{if(sendGcode(e,!1,!1),await getResponse()){n=!0;break}showInfo("Connection failed, retrying..."),await sleep(1e3),cancelInfo(),t--}while(t>0);return n}async function requestInit(){try{initDone=!1,nextCfgIndex=0;var e=["M115","M114",'M205P"WebInterface"S1',"M503S1W","M503S2W","M503S3W","M503S4W","M503S5W","M503S6W",'M20S"/test" F"" W',"M17","M122W0","M122W1","M122W2","M122W3",'M205P"SendStats"S1'];addSentGcode("<<< WebInterface Init Start >>>"),showInfo("Fetching settings from SMuFF, please wait...");for(var t=!0,n=0;n<e.length&&!isTestRunning;n++){if(!await sendInitSeq(e[n])){t=!1;break}if(initDone)break}return addSentGcode("<<< WebInterface Init End >>>"),cancelInfo(),showChangesPending(!1),initDone=!0,t}catch(e){console.log(e)}return!1}async function listenToSerial(){const e=new TextDecoderStream;readableStream=port.readable.pipeTo(e.writable),reader=e.readable.getReader(),portListener=!0;for(var t="";;){const{value:e,done:a}=await reader.read();if(e)-1!=e.indexOf("")&&(pauseTransmission=!0,console.log("XOff"),t+=e.replaceAll("","")),-1!=e.indexOf("")?(pauseTransmission=!1,console.log("XOn"),t+=e.replaceAll("","")):t+=e;for(;t.length;){var n=t.indexOf("\n");if(-1==n)break;var o=t.substring(0,n);await parseResponse(o),collectResponse&&"ok"!=o&&(responseBuffer+=o+"\n"),t=t.substring(n+1)}if(a){reader.releaseLock();break}}portListener=!1,showConnect()}async function parseResponse(e){if(prevLine=e,isBooting&&"start"!=e)return $("#info-message").html(booting+"<br/><p>"+e.substring(11)+"</p>"),void addReceivedGcode(e.replaceAll(" ","&nbsp;"));if(isPurging||isShowingLoading||isShowingUnloading||cancelInfo(),e.startsWith("ok")){if(seenOk=!0,(isShowingLoading||isShowingUnloading)&&(isPurging||cancelInfo(),isShowingLoading=!1,isShowingUnloading=!1),!initDone)return}else if(e.startsWith("error:"))seenError=!0,"BUSY"==e.substring(7)&&showToast("SMuFF is BUSY"),console.log("Errors seen: "+seenError+" [ "+prevLine+" ]");else if("start"==e)isBooting=!1,cancelInfo(),requestInit();else if(e.startsWith("echo: dbg: [ setup start ]"))isBooting=!0,initDone=!0,showInfo(booting);else{if(e.startsWith("echo: Serial:"))return currentSerial=parseInt(e.substring(14)),void $("#curSerial"+currentSerial).removeClass("hidden");if(e.startsWith("echo: states:"))return isPurging=isShowingLoading=isShowingUnloading=!1,void setStatus(e);if(e.startsWith("echo: testrun:"))return setTestResults(e),void showTestRunning(!0);if(e.startsWith("echo: purging:"))return isPurging=!0,void showPurging(e.substring(15));if(e.startsWith("echo: speed:"))return void(xlatedSpeed=e.substring(12));if(e.startsWith("echo: INT")||e.startsWith("echo: EXT")){if(setRelayState(e.substring(6)),!initDone)return}else if(e.startsWith("FIRMWARE_NAME"))setFWInfo(e);else if(e.startsWith("M17")){if(!initDone)return}else{if(e.startsWith("Unknown parameter 'WebInterface"))return initDone=!0,void showError("Apparently, this SMuFF-Firmware version is <b>less than 2.26</b>! Please update your firmware for this app.");if(e.startsWith("/*")){if(configType=e.replace("/*","").replace("*/","").trim(),!initDone)return void(configType.startsWith("Testscripts")&&(addTestFiles(configType.substring(12)),configType=""))}else if(e.startsWith('{"')){if(e.indexOf("TMCStatus")>-1&&(configType="TMC"),setSettings(e,configType),!initDone)return}else if(e.startsWith("M122")){if(!initDone)return}else if(e.startsWith("M205")){if(!initDone)return}else if(e.startsWith("M503")&&!initDone)return}}addReceivedGcode(e.replaceAll(" ","&nbsp;"))}async function animateWiper(){var e=0,t=0,n=$("#WipeSeq").val().matchAll(/([a-zA-Z]\d{1,3})/g);for(const o of n)o[0].toUpperCase().startsWith("R")&&(e=parseInt(o[0].substring(1))),o[0].toUpperCase().startsWith("S")&&(t=parseInt(o[0].substring(1)));var o=7*t;$("#lvc-wiper-image-1").hide(),$("#lvc-wiper-image-2").show(),await sleep(100),$("#lvc-wiper-image-2").hide(),$("#lvc-wiper-image-3").show(),await sleep(100);for(var a=0;a<e;a++)$("#lvc-wiper-image-3").hide(),$("#lvc-wiper-image-4").show(),await sleep(o),$("#lvc-wiper-image-4").hide(),$("#lvc-wiper-image-3").show(),await sleep(o);$("#lvc-wiper-image-3").hide(),$("#lvc-wiper-image-2").show(),await sleep(100),$("#lvc-wiper-image-2").hide(),$("#lvc-wiper-image-1").show(),await sleep(100)}async function animateCutter(){for(var e=0;e<3;e++)$("#lvc-cutter-image-1").hide(),$("#lvc-cutter-image-2").show(),await sleep(100),$("#lvc-cutter-image-2").hide(),$("#lvc-cutter-image-3").show(),await sleep(0==e?750:375),$("#lvc-cutter-image-3").hide(),$("#lvc-cutter-image-2").show(),await sleep(100),$("#lvc-cutter-image-2").hide(),$("#lvc-cutter-image-1").show(),await sleep(100)}function setFeederLed(e){$("#lvc-feeder-led").css("opacity",e?1:0)}function setSelectorLed(e){$("#lvc-selector-led").css("opacity",e?0:1)}function getRodPosition(e){var t=$("#Tools").val()-1,n=parseInt($("#Selector-Spacing").val()*t),o=parseInt(e-$("#lvc-rod").offset().left),a=$("#lvc-rod").width();return parseInt((a-o)*(n/a))}function positionCarrier(e){var t=$("#Tools").val(),n=parseInt($("#Selector-Spacing").val())*t;e*=$("#lvc-rod").width()/n,$("#lvc-carrier").css("right",90+e+"px")}function getToolCount(){return""==$("#Tools").val()?-1:parseInt($("#Tools").val())}function setupMaterials(){var e=getToolCount();if(-1!=e){var t=$("#form-materials");t.empty(),t.append('<datalist id="datalistColors"></datalist>'),t.append('<datalist id="datalistMaterials"></datalist>');var n=t.find('datalist[id="datalistColors"]');for(key in Object.keys(colorNames)){var o='<option value="'+colorNames[key].label+'"/>';n.append(o)}for(key in n=t.find('datalist[id="datalistMaterials"]'),Object.keys(materialNames)){o='<option value="'+materialNames[key].label+'"/>';n.append(o)}for(var a=$("#materials-template"),i=0;i<e;i++){var r=a.clone(!0);r.prop("id","materials-tool-"+i),r.removeClass("hidden"),r.find("label").text("T"+i+":"),r.find("input").each((function(){$(this).prop("id",$(this).prop("name")+i),$(this).attr("data-section","S5"),$(this).attr("data-subsection","T"+i)})),t.append(r)}}}function setupServoMappings(){var e=getToolCount();if(-1!=e){var t=$("#form-servomaps");t.empty();for(var n=$("#servomap-template"),o=0;o<e;o++){var a;(a=n.clone(!0)).prop("id","servomap-"+o),a.removeClass("hidden"),a.find("label").text("T"+o+":"),a.find("input").each((function(){$(this).prop("id",$(this).prop("name")+o),$(this).attr("data-section","S4"),$(this).attr("data-subsection","T"+o),hasMultiservo||"Output-"!=$(this).prop("name")||($(this).addClass("hidden"),$("#caption-multiservo").hide())})),t.append(a)}if(hasMultiservo)(a=n.clone(!0)).prop("id","servomap-wiper"),a.removeClass("hidden"),a.find("label").text("Wiper:"),a.find("input").each((function(){$(this).prop("id",$(this).prop("name")+"Wiper"),$(this).attr("data-section","S4"),$(this).attr("data-subsection","Wiper")})),t.append(a)}}function setupLiveControl(){var e=getToolCount();if(-1!=e){var t=$("#lvc-slot-container");t.empty();for(var n=$("#lvc-slot-template"),o=e-2;o>0;o--){var a=n.clone(!0);a.prop("id","lvc-t-"+o),a.removeClass("hidden");var i=a.find('span[id="lvc-tool"]');i.prop("id","lvc-tool-"+o).data("tool",o),i.attr("data-bs-original-title","T"+o).tooltip("update"),(i=a.find('span[id="lvc-led"]')).prop("id","lvc-led-"+o),t.append(a)}n.removeClass("d-flex").addClass("hidden");var r=e-1;$("#lvc-tool-Max").prop("id","lvc-tool-"+r).data("tool",r.toString()).attr("data-bs-original-title","T"+r).tooltip("update"),$("#lvc-led-Max").prop("id","lvc-led-"+r),$('span[id^="lvc-tool-"]').on("click",(function(){var e=$(this).prop("id").substring(9);moveCarrierG1=!1,setServoHorn(!1),$("#tool-selection").val("T"+e).trigger("change")})),$("#lvc-rod").width(e*$("#lvc-slot-template").width())}}function setupSwaps(){var e=getToolCount();if(-1!=e){var t=$("#swap-tools-container #slots ul"),n=$("#swap-tools-container #tools ul");t.empty(),n.empty();for(var o=0;o<e;o++){var a=$("#slot-item-template").clone(!0);a.append("<span>Slot "+o+":</span>"),a.append('<span class="slot-tool-color">'+(""!=toolColors[o]?"(":"")+toolColors[o]+(""!=toolColors[o]?")":"")+"</span>"),a.attr("id","slot"+o),t.append(a);var i=$("#swap-item-template").clone(!0);i.text(i.text()+(void 0===swapTools[o]?o:swapTools[o])),i.attr("id","swap-tool"+o),i.attr("data-id","st-"+swapTools[o]),i.css("cursor","grab"),i.append('<i class="fa fa-reorder"></i>'),n.append(i)}}}$(document).ready((function(){$("#lvc-cutter-image-2").hide(),$("#lvc-cutter-image-3").hide(),$("#lvc-wiper-image-2").hide(),$("#lvc-wiper-image-3").hide(),$("#lvc-wiper-image-4").hide(),$("#lvc-horn-image").tooltip({delay:{show:100,hide:100},trigger:"hover"}),$("#lvc-horn, #lvc-horn-image").on("click",(function(){-1!=getCurrentTool()?$("#card-lid").trigger("click"):showToast("No tool selected!")})),$("#lvc-rod").tooltip({delay:{show:100,hide:100},trigger:"manual"}),$("#lvc-rod").on("mousemove",(function(e){var t=getRodPosition(e.pageX);$("#lvc-rod").attr("data-bs-original-title",t+" mm").tooltip("update").tooltip("show")})),$("#lvc-rod").on("click",(async function(e){moveCarrierG1=!0,$("#selector-pwr-off").addClass("hidden");var t=getRodPosition(e.pageX);positionCarrier(t),sendGcode("G90",!1,!1),await getResponse(),sendGcode("G1X"+t,!1,!1),await getResponse(),sendGcode("G91",!1,!1),await getResponse()})),$("#lvc-home").on("click",(function(e){moveCarrierG1=!1,setServoHorn(!1),$("#tool-selection").val(-1).trigger("change")})),$("#lvc-selector").on("click",(function(e){sendGcode("M18X",!1,!1),$("#selector-pwr-off").removeClass("hidden")})),$("#lvc-feeder").on("click",(function(e){sendGcode("M18Z",!1,!1),$("#feeder-pwr-off").removeClass("hidden")})),$("#lvc-feed").on("click",(function(e){-1!=getCurrentTool()?isFeederLoaded?$("#btn-unload").trigger("click"):$("#btn-load").trigger("click"):showToast("No tool selected!")})),$("#lvc-cutter").on("click",(function(e){sendGcode("G12C"),animateCutter()})),$("#lvc-wiper").on("click",(function(e){sendGcode("G12"),animateWiper()})),$("#lvc-reset").on("click",(function(e){$("#btn-reset").trigger("click")}))})),$(document).ready((function(){$("#Tools").on("change",(function(){var e=getToolCount(),t=$("#tool-selection");t.empty(),t.append('<option value="-1">T--</option>');for(var n=0;n<e;n++)t.append('<option value="T'+n+'">T'+n+"</option>");for(n=MAX_TOOLS-1;n>=e;n--)$("#tst-t"+n).parent().hide();setupMaterials(),setupServoMappings(),setupLiveControl(),setupSwaps()})),$("#SpdsInMms").on("click",(function(){setTimeout((function(){recalculateSpeeds()}),750)})),$("#Feeder-SharedStepper").on("change",(function(){setDisabled(!(hasSharedStepper=$(this).is(":checked")),".hasSharedStepper")})),$("#Feeder-UseEStop2").on("change",(function(){setDisabled(!$(this).is(":checked"),".has2ndEndstop")})),$("#Feeder-ExtCtrl").on("change",(function(){setDisabled(hasExtCtrl=$(this).is(":checked"),".hasNotExtCtrl")})),$("#UseCutter").on("change",(function(){setDisabled(!$(this).is(":checked"),".hasCutter")})),$("#Revolver-UseServo").on("change",(function(){hasV6S&&$(this).removeAttr("checked"),setDisabled(!$(this).is(":checked"),".hasServo")})),$("#InvRelay").on("change",(function(){setTimeout((async function(){sendGcode("M17",!0,!1),await getResponse()}),500)})),$("#Selector-TMC-Mode").on("change",(function(){1==$(this).val()?($("#Selector-TMC-Params").show("slow"),$("#Selector-MS3").val(0).trigger("change")):$("#Selector-TMC-Params").hide("slow")})),$("#Feeder-TMC-Mode").on("change",(function(){1==$(this).val()?($("#Feeder-TMC-Params").show("slow"),$("#Feeder-MS3").val(0).trigger("change")):$("#Feeder-TMC-Params").hide("slow")})),$("#Revolver-TMC-Mode").on("change",(function(){1==$(this).val()?($("#Revolver-TMC-Params").show("slow"),$("#Revolver-MS3").val(0).trigger("change"),$("#Revolver-UseServo").prop("checked",!1).trigger("change")):$("#Revolver-TMC-Params").hide("slow")})),$("#Selector-MS3").on("change",(function(){$(this).val()>0&&$("#Selector-TMC-Mode").val(0).trigger("change")})),$("#Feeder-MS3").on("change",(function(){$(this).val()>0&&$("#Feeder-TMC-Mode").val(0).trigger("change")})),$("#Revolver-MS3").on("change",(function(){$(this).val()>0&&$("#Revolver-TMC-Mode").val(0).trigger("change")}))}));